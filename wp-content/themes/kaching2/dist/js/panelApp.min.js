(function($){
!function(){"use strict";angular.module("panelApp",["underscore","ngSanitize","ngCookies","ngAnimate","ngTouch","ui.router","ui.bootstrap","mgcrea.ngStrap","daterangepicker","com.2fdevs.videogular","infinite-scroll","angularFileUpload","chart.js"]).constant("apiUrl",kachingAppConfig.apiUrl).constant("sessionDays",30).constant("statePermissions",{advertiser:["expired","account","cards","funds","billing","campaigns","campaigns.edit","campaigns.new","campaigns.new.step1","campaigns.new.step2","campaigns.new.step3","campaigns.new.step4","campaigns.new.step5","campaigns.new.step6","media","media.view","media.edit","products","products.view","products.edit"],developer:["expired","account","apikeys"]}),angular.module("panelApp").config(["$stateProvider","$urlRouterProvider","statePermissions",function(e,t,a){var n="panel-module/controllers/",i={controller:"headerCtrl",templateUrl:"panel-module/components/header/headerTmpl.html"};e.state("expired",{url:"/expired",data:{title:"Session Expired"},views:{"header@":i,"main@":{controller:"expiredCtrl",templateUrl:n+"expired/expiredTmpl.html"}}}).state("account",{url:"/account",data:{title:"Account Settings"},views:{"header@":i,"main@":{controller:"profileCtrl",templateUrl:n+"profile/profileTmpl.html"}}}).state("cards",{url:"/credit-cards",data:{title:"Credit Cards"},views:{"header@":i,"main@":{controller:"creditCardsCtrl",templateUrl:n+"creditCards/creditCardsTmpl.html"}}}).state("funds",{url:"/add-funds",data:{title:"Add Funds"},views:{"header@":i,"main@":{controller:"addFundsCtrl",templateUrl:n+"addFunds/addFundsTmpl.html"}}}).state("billing",{url:"/billing",data:{title:"Billing"},views:{"header@":i,"main@":{controller:"billingCtrl",templateUrl:n+"billing/billingTmpl.html"}}}).state("campaigns",{url:"/campaigns",data:{title:"Campaigns"},views:{"header@":i,"main@":{controller:"campaignsCtrl",templateUrl:n+"campaigns/campaignsTmpl.html"}}}).state("campaigns.edit",{url:"/edit/:campaignId",data:{title:"Edit Campaign"},views:{"main@":{controller:"editCampaignCtrl",templateUrl:n+"campaignEditor/editCampaignTmpl.html"}}}).state("campaigns.new",{url:"/new-campaign",data:{title:"New Campaign"},views:{"main@":{controller:"campaignEditorCtrl",templateUrl:n+"campaignEditor/campaignEditorTmpl.html"}}}).state("campaigns.new.step1",{views:{campaignEditorMain:{controller:"campaignEditorStep1Ctrl",templateUrl:n+"campaignEditor/steps/step1Tmpl.html"}}}).state("campaigns.new.step2",{views:{campaignEditorMain:{controller:"campaignEditorStep2Ctrl",templateUrl:n+"campaignEditor/steps/step2Tmpl.html"}}}).state("campaigns.new.step3",{views:{campaignEditorMain:{controller:"campaignEditorStep3Ctrl",templateUrl:n+"campaignEditor/steps/step3Tmpl.html"}}}).state("campaigns.new.step4",{views:{campaignEditorMain:{controller:"campaignEditorStep4Ctrl",templateUrl:n+"campaignEditor/steps/step4Tmpl.html"}}}).state("campaigns.new.step5",{views:{campaignEditorMain:{controller:"campaignEditorStep5Ctrl",templateUrl:n+"campaignEditor/steps/step5Tmpl.html"}}}).state("campaigns.new.step6",{views:{campaignEditorMain:{controller:"campaignEditorStep6Ctrl",templateUrl:n+"campaignEditor/steps/step6Tmpl.html"}}}).state("media",{url:"/media",data:{title:"Media"},views:{"header@":i,"main@":{controller:"mediaCtrl",templateUrl:n+"media/mediaTmpl.html"}}}).state("media.view",{url:"/view/:mediaId",data:{title:"View Media"},views:{"main@":{controller:"mediaViewCtrl",templateUrl:n+"mediaView/mediaViewTmpl.html"}}}).state("media.edit",{url:"/edit/:mediaId",data:{title:"Edit Media"},views:{"main@":{controller:"mediaEditCtrl",templateUrl:n+"mediaEdit/mediaEditTmpl.html"}}}).state("products",{url:"/products",data:{title:"Products"},views:{"header@":i,"main@":{controller:"productsCtrl",templateUrl:n+"products/productsTmpl.html"}}}).state("products.view",{url:"/view/:productId",data:{title:"View Product"},views:{"main@":{controller:"productViewCtrl",templateUrl:n+"productView/productViewTmpl.html"}}}).state("products.edit",{url:"/edit/:productId",data:{title:"Edit Product"},views:{"main@":{controller:"productEditCtrl",templateUrl:n+"productEdit/productEditTmpl.html"}}}).state("apikeys",{url:"/api-keys",data:{title:"API Keys"},views:{"header@":i,"main@":{controller:"apiKeysCtrl",templateUrl:n+"apiKeys/apiKeysTmpl.html"}}})}]),angular.module("panelApp").run(["$rootScope","$location","$state","authService","permissionsService",function(e,t,a,n,i){n.isAdvertiser()?a.transitionTo("campaigns"):n.isDeveloper()&&a.transitionTo("apikeys"),e.$on("stateNotFound",function(e,t,i,o){n.isAdvertiser()?a.transitionTo("campaigns"):n.isDeveloper()&&a.transitionTo("apikeys")}),e.$on("$stateChangeStart",function(e,t,o,r){if("expired"!==t.name)return n.isLoggedIn()?i.userHasAccess(t.name)?void 0:(n.isAdvertiser()?a.transitionTo("campaigns"):n.isDeveloper()&&a.transitionTo("apikeys"),void e.preventDefault()):(a.transitionTo("expired"),void e.preventDefault())})}])}(),function(){"use strict";angular.module("panelApp").config(["$provide",function(e){e.decorator("nvFileDropDirective",["$delegate",function(e){var t=e[0],a=t.link;return t.compile=function(){return function(e,t,n){var i=n.ifmOverClass||"fileover";a.apply(this,arguments),t.on("dragover",function(){t.addClass(i)}),t.on("dragleave",function(){t.removeClass(i)}),t.on("drop",function(){t.removeClass(i)})}},e}])}])}(),function(){"use strict";angular.module("panelApp").directive("ifmClipboard",["$tooltip",function(e){return{restrict:"A",scope:{clipboardSuccess:"&",clipboardError:"&",tooltipTitle:"@",tooltipPlacement:"@",tooltipAnimation:"@"},link:function(t,a){var n="undefined"==typeof t.tooltipTitle?"Copied":t.tooltipTitle,i="undefined"==typeof t.tooltipPlacement?"top":t.tooltipPlacement,o="undefined"==typeof t.tooltipAnimation?"am-fade-and-scale":t.tooltipAnimation,r=e(a,{title:n,placement:i,animation:o,trigger:"manual"});a.on("mouseout",function(){r.hide()});var s=new Clipboard(a[0]);s.on("success",function(e){r.show(),t.$apply(function(){t.clipboardSuccess({e:e})})}),s.on("error",function(e){t.$apply(function(){t.clipboardError({e:e})})})}}}])}(),function(){"use strict";angular.module("panelApp").controller("headerCtrl",["$scope","$state","authService","$window",function(e,t,a,n){e.loggedIn=a.isLoggedIn(),e.logoSrc=kachingAppConfig.wpTemplateUri+"/assets/images/ic_kaching.png",e.logoClick=function(){a.isAdvertiser()?t.go("campaigns"):a.isDeveloper()?t.go("apikeys"):n.location.href=kachingAppConfig.homeUrl}}])}(),function(){"use strict";console.log("campaignDetailsModalCtrl loaded"),angular.module("panelApp").controller("campaignDetailsModalCtrl",["$scope","errorHandler","$sce","campaignsService","campaignId",function(e,t,a,n,i){e.videogularApi=null,e.view={busy:!1},e.campaign={},e.media={},e.products=[],e.videogular={sources:[]},e.view.busy=!0,n.getCampaign(i).then(function(t){e.campaign=t,t.products.length>0&&(e.products=t.products),t.media.length>0&&(e.media=t.media[0],e.setVideo()),e.view.busy=!1},function(a){e.view.busy=!1,t.processApiResponse(a),e.$hide()}),e.hasMedia=function(){return!_.isEmpty(e.media)},e.hasProducts=function(){return e.products.length>0},e.onPlayerReady=function(t){e.videogularApi=t},e.setVideo=function(){e.videogular.sources=[{src:a.trustAsResourceUrl(e.media.video),type:"video/mp4"}]}}])}(),function(){"use strict";console.log("campaignDeleteModalCtrl loaded"),angular.module("panelApp").controller("campaignDeleteModalCtrl",["$scope","$alert","campaignsService","modalOptions","campaign",function(e,t,a,n,i){console.log("in campaignDeleteModalCtrl",i),e.campaign=i,e.delete=function(){n.delete(i),e.$hide()}}])}(),function(){"use strict";angular.module("panelApp").controller("campaignStopModalCtrl",["$scope","$alert","campaignsService","callbacks","campaign",function(e,t,a,n,i){e.campaign=i,e.stopCampaign=function(){n.stopCampaign(i),e.$hide()}}])}(),function(){"use strict";console.log("mediaDeleteModalCtrl loaded"),angular.module("panelApp").controller("mediaDeleteModalCtrl",["$scope","$alert","mediaService","modalOptions","media",function(e,t,a,n,i){console.log("in mediaDeleteModalCtrl",i),e.media=i,e.delete=function(){n.delete(i),e.$hide()}}])}(),function(){"use strict";console.log("mediaLibraryModalCtrl loaded"),angular.module("panelApp").controller("mediaLibraryModalCtrl",["$scope","errorHandler","modalOptions","mediaService",function(e,t,a,n){console.log("in mediaLibraryModalCtrl");var i=6;e.view={busy:!0,currentPage:1,mediaCount:0,media:[],maxSize:10,searchPhrase:"",searchInput:"",orderByOptions:[{value:"name",label:"Order by title"},{value:"-date_added",label:"Newest first"}],orderBy:"-date_added",itemsPerPage:i,selectItem:!1},e.selectMedia=function(){a.submit(e.view.selectItem),e.$hide()},e.search=function(){e.view.currentPage=1,e.view.searchPhrase=e.view.searchInput,r()},e.changeOrder=function(){r()},e.changePage=function(){r()},e.toggleItem=function(t){t.selected?(t.selected=!1,e.view.selectItem=!1):("object"==typeof e.view.selectItem&&(e.view.selectItem.selected=!1),t.selected=!0,e.view.selectItem=t)};var o=function(){r()},r=function(a){var o={limit:i,offset:i*(e.view.currentPage-1),ordering:e.view.orderBy};e.view.searchPhrase.length>0&&(o.name=e.view.searchPhrase),e.view.busy=!0,n.getMedia(o).then(function(t){e.view.mediaCount=t.count,e.view.media=t.items,e.view.busy=!1},function(a){e.view.busy=!1,t.processApiResponse(a),e.$hide()})};o()}])}(),function(){"use strict";angular.module("panelApp").controller("producstLibraryModalCtrl",["$scope","errorHandler","modalOptions","productsService",function(e,t,a,n){var i=8;e.view={busy:!0,currentPage:1,productsCount:0,products:[],maxSize:10,searchPhrase:"",searchInput:"",orderByOptions:[{value:"name",label:"Order by title"},{value:"-date_added",label:"Newest first"}],orderBy:"-date_added",itemsPerPage:i,selectItem:!1},e.selectProduct=function(){a.submit(e.view.selectItem),e.$hide()},e.search=function(){e.view.currentPage=1,e.view.searchPhrase=e.view.searchInput,r()},e.changeOrder=function(){r()},e.changePage=function(){r()},e.toggleItem=function(t){t.selected?(t.selected=!1,e.view.selectItem=!1):("object"==typeof e.view.selectItem&&(e.view.selectItem.selected=!1),t.selected=!0,e.view.selectItem=t)};var o=function(){r()},r=function(a){var o={limit:i,offset:i*(e.view.currentPage-1),ordering:e.view.orderBy};e.view.searchPhrase.length>0&&(o.title=e.view.searchPhrase),e.view.busy=!0,n.getProducts(o).then(function(t){e.view.productsCount=t.count,e.view.products=t.items,e.view.busy=!1},function(a){e.view.busy=!1,t.processApiResponse(a),e.$hide()})};o()}])}(),function(){"use strict";angular.module("panelApp").controller("newMediaModalCtrl",["$scope","$state","$alert","apiUrl","authToken","utils","mediaService","FileUploader","modalOptions",function(e,t,a,n,i,o,r,s,d){var c=e.uploader=new s({url:n+"/media/",method:"PATCH",headers:{Authorization:"Token "+i.get()}});e.fieldHasError=o.fieldHasError,e.view={uploading:!1,submitted:!1,mediaCreated:!1,videoUploadStarted:!1,videoUploadProgress:0,videoUploadComplete:!1,imageUploadStarted:!1,imageUploadProgress:0,imageUploadComplete:!1},e.data={videoFile:"",imageFile:"",mediaName:"",mediaId:""},e.errors={video:{},image:{}};var l=function(){o.addUploaderTypeFilter(c,"video",{videoFilter:["video/mp4","video/ogg","video/webm","video/mov","video/avi","video/quicktime"]}),o.addUploaderTypeFilter(c,"display",{imageFilter:["image/png","image/jpg","image/jpeg"]})};c.onAfterAddingFile=function(t){o.cleanupUploaderQueue(c),"video"===t.alias&&(e.data.videoFile=t._file),"display"===t.alias&&(e.data.imageFile=t._file,r.imageSizeHelper(t._file).then(function(t){r.imageSizeValid(t.width,t.height)?delete e.errors.image.size:e.errors.image.size=!0}))},c.onBeforeUploadItem=function(t){"video"===t.alias&&(e.view.videoUploadStarted=!0),"display"===t.alias&&(e.view.imageUploadStarted=!0),t.url=n+"/media/"+e.data.mediaId+"/"},c.onCompleteItem=function(t,a,n,i){"video"===t.alias&&(e.view.videoUploadComplete=!0),"display"===t.alias&&(e.view.imageUploadComplete=!0)},c.onProgressItem=function(t,a){"video"===t.alias&&(e.view.videoUploadProgress=a),"display"===t.alias&&(e.view.imageUploadProgress=a)},c.onCompleteAll=function(){e.view.mediaCreated=!0,"campaignEditor"===d.mode&&e.closeModal()},e.showErrors=function(){return e.view.submitted},e.videoHasError=function(){return"object"!=typeof e.data.videoFile},e.imageHasError=function(){return!("object"==typeof e.data.imageFile&&!e.errors.image.size)},e.viewMedia=function(){e.$hide(),t.go("media.view",{mediaId:e.data.mediaId})},e.saveMedia=function(){e.view.submitted=!0,!e.form1.$valid||e.imageHasError()||e.videoHasError()||(e.view.uploading=!0,r.createMedia(e.data.mediaName).then(function(t){e.data.mediaId=t.id,c.uploadAll()},function(){}))},e.closeModal=function(){e.view.mediaCreated&&_.isFunction(d.submit)&&d.submit(e.data.mediaId),e.$hide()},l()}])}(),function(){"use strict";angular.module("panelApp").controller("newProductModalCtrl",["$scope","$state","errorHandler","apiUrl","authToken","utils","productsService","FileUploader","modalOptions",function(e,t,a,n,i,o,r,s,d){var c=e.uploader=new s({url:n+"/products/",method:"POST",headers:{Authorization:"Token "+i.get()}});e.fieldHasError=o.fieldHasError,e.urlRegex=o.urlRegex(),e.view={uploading:!1,submitted:!1,uploadStarted:!1,uploadProgress:0,uploadComplete:!1,productCreated:!1,externalProducts:[]},e.data={productId:void 0,title:"",url:"",price:"",description:"",image:"",imageFile:"",external:!1};var l=function(){o.addUploaderTypeFilter(c,"image",{imageFilter:["image/png","image/jpg","image/jpeg"]})};c.onAfterAddingFile=function(t){o.cleanupUploaderQueue(c),e.data.imageFile=t._file},c.onBeforeUploadItem=function(t){var a={title:e.data.title,url:e.data.url,price:e.data.price,description:e.data.description};null===a.url.match(/^http[s]?:\/\//i)&&(a.url="http://"+a.url),e.data.image_url&&(a.image_url=e.data.image_url),e.data.external_id&&(a.external_id=e.data.external_id),t.formData.push(a),e.view.uploading=!0,e.view.uploadStarted=!0},c.onProgressItem=function(t,a){e.view.uploadProgress=a},c.onSuccessItem=function(t,a,n,i){console.log("onSuccessItem",t,a,n,i),e.data.productId=a.id,e.data.image=a.image,e.data.date_added=a.date_added,e.data.is_active=a.is_active,e.view.productCreated=!0,"campaignEditor"===d.mode&&e.closeModal()},c.onCompleteAll=function(){e.view.uploadComplete=!0},e.showErrors=function(){return e.view.submitted},e.imageHasError=function(){return!e.data.imageFile},e.viewProduct=function(){e.$hide(),t.go("products.view",{productId:e.data.productId})},e.saveProduct=function(){e.view.submitted=!0,e.form1.$valid&&(e.data.external===!0?e.createProductFromExternal():c.uploadAll())},e.closeModal=function(){e.view.productCreated&&_.isFunction(d.submit)&&d.submit({id:e.data.productId,title:e.data.title,url:e.data.url,price:e.data.price,description:e.data.description,image:e.data.image,date_added:e.data.date_added,is_active:e.data.is_active}),e.$hide()},e.searchExternalProducts=function(){e.view.busy=!0,r.searchExternalProducts({search:e.view.externalProductsSearchInput}).then(function(t){e.view.externalProducts=t,e.view.busy=!1},function(t){e.view.busy=!1,a.processApiResponse(t),e.$hide()})},e.resetExternalProducts=function(){e.view.externalProducts=[]},e.addExternalProduct=function(t){e.data.external=!0,e.data.title=t.name,e.data.url=t.medium_image,e.data.price=t.price_min,e.data.description=t.description?t.description:t.name,e.data.image_url=t.medium_image,e.data.external_id=t.asin,e.data.imageFile=t.medium_image,e.data.image=t.medium_image,e.resetExternalProducts()},e.createProductFromExternal=function(){r.createProductFromExternal(e.data).then(function(t){e.data.productId=t.id,e.view.productCreated=!0,"campaignEditor"===d.mode&&e.closeModal()},function(t){e.view.busy=!1,a.processApiResponse(t),e.$hide()})},l()}])}(),function(){"use strict";console.log("productDeleteModalCtrl loaded"),angular.module("panelApp").controller("productDeleteModalCtrl",["$scope","modalOptions","product","index",function(e,t,a,n){e.product=a,e.delete=function(){t.delete(a,n),e.$hide()}}])}(),function(){"use strict";angular.module("panelApp").controller("passwordChangeModalCtrl",["$scope","$alert","errorHandler","utils","userService",function(e,t,a,n,i){e.fieldHasError=n.fieldHasError,e.view={sending:!1,submitted:!1},e.data={currentPassword:"",newPassword:"",newPasswordRepeat:""},e.showErrors=function(){return e.view.submitted},e.changePassword=function(){e.view.submitted=!0,e.form1.$valid&&(e.view.sending=!0,i.changePassword(e.data.currentPassword,e.data.newPassword).then(function(){e.view.sending=!1,t({title:"Your password has been changed.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),e.$hide()},function(t){console.log("changePassword response",t),400===t.status&&"undefined"!=typeof t.data.current_password?(e.form1.current_password.$setValidity("password",!1),e.view.sending=!1):(a.processApiResponse(t),e.$hide())}))}}])}(),function(){"use strict";angular.module("panelApp").controller("appDeleteModalCtrl",["$scope","$alert","campaignsService","modalOptions","app",function(e,t,a,n,i){e.app=i,e.delete=function(){n.delete(i),e.$hide()}}])}(),function(){"use strict";angular.module("panelApp").controller("newAppModalCtrl",["$scope","errorHandler","utils","modalOptions","applicationsService",function(e,t,a,n,i){e.fieldHasError=a.fieldHasError,e.view={loading:!0,sending:!1,showErrors:!1,categoriesError:!1},e.data={appName:"",categories:[],selectedCategories:[]};var o=function(){e.view.loading=!0,i.getCategories().then(function(t){e.data.categories=t,e.setSelectedCategories(),e.view.loading=!1},function(){t.processApiResponse(response),e.$hide()})};e.setSelectedCategories=function(){e.data.selectedCategories=[],angular.forEach(e.data.categories,function(t){t.selected&&e.data.selectedCategories.push(t.id)}),e.view.categoriesError=0===e.data.selectedCategories.length},e.clearCustomErrors=function(){e.form1.key_name.$setValidity("nameUnique",!0)};var r=function(e){var t=_.findWhere(e.data.errorDetails.paramsMistake.mistakenParams,{name:"name"});return"undefined"!=typeof t};e.formSubmit=function(){e.view.sending=!0,e.form1.$valid&&e.view.categoriesError===!1?i.addApp(e.data.appName,e.data.selectedCategories).then(function(t){n.submit(t),e.$hide()},function(a){400===a.status&&r(a)?(e.form1.key_name.$setValidity("nameUnique",!1),e.view.sending=!1,e.view.showErrors=!0):(t.processApiResponse(a),e.$hide())}):(e.view.sending=!1,e.view.showErrors=!0)},o()}])}(),function(){"use strict";angular.module("panelApp").controller("newCardModalCtrl",["$scope","errorHandler","utils","callbacks","billingService",function(e,t,a,n,i){e.fieldHasError=a.fieldHasError,e.view={braintreeLoading:!0,braintreeReady:!1,nonceReceived:!1,savingCard:!1,cardSaved:!1};var o=function(){i.getClientToken().then(function(a){var o;braintree.setup(a,"dropin",{container:"braintree-form",onReady:function(t){e.view.braintreeLoading=!1,o=t,e.view.braintreeReady=!0,e.$apply()},onPaymentMethodReceived:function(a){console.log("onPaymentMethodReceived",a),e.view.nonceReceived=!0,e.view.savingCard=!0,o.teardown(function(){o=null});var r={payment_method_nonce:a.nonce};i.addCard(r).then(function(){e.view.savingCard=!1,e.view.cardSaved=!0,n.cardAdded()},function(a){t.processApiResponse(a),e.$hide()})}})},function(){t.processApiResponse(response),e.$hide()})};o()}])}(),function(){"use strict";angular.module("panelApp").controller("cardDeleteModalCtrl",["$scope","$alert","callbacks","card",function(e,t,a,n){e.card=n,e.delete=function(){a.delete(n),e.$hide()}}])}(),function(){"use strict";angular.module("panelApp").controller("appKeyModalCtrl",["$scope","app",function(e,t){e.app=t}])}(),function(){"use strict";angular.module("panelApp").controller("appEditModalCtrl",["$scope","app","utils","modalOptions","errorHandler","applicationsService",function(e,t,a,n,i,o){e.fieldHasError=a.fieldHasError,e.view={loading:!0,sending:!1,showErrors:!1,categoriesError:!1},e.data={appName:t.name,categories:[],selectedCategories:t.app_categories};var r=function(){e.view.loading=!0,o.getCategories(t.app_categories).then(function(t){e.data.categories=t,e.setSelectedCategories(),e.view.loading=!1},function(){i.processApiResponse(response),e.$hide()})};e.setSelectedCategories=function(){e.data.selectedCategories=[],angular.forEach(e.data.categories,function(t){t.selected&&e.data.selectedCategories.push(t.id)}),e.view.categoriesError=0===e.data.selectedCategories.length},e.clearCustomErrors=function(){e.form1.key_name.$setValidity("nameUnique",!0)};var s=function(e){var t=_.findWhere(e.data.errorDetails.paramsMistake.mistakenParams,{name:"name"});return"undefined"!=typeof t};e.formSubmit=function(){e.view.sending=!0,e.form1.$valid&&e.view.categoriesError===!1?o.updateApp(t.id,e.data.appName,e.data.selectedCategories).then(function(t){n.submit(t),e.$hide()},function(t){400===t.status&&s(t)?(e.form1.key_name.$setValidity("nameUnique",!1),console.log(">>>> name error"),e.view.sending=!1,e.view.showErrors=!0):(i.processApiResponse(t),e.$hide())}):(e.view.sending=!1,e.view.showErrors=!0)},r()}])}(),function(){"use strict";console.log("expiredCtrl loaded"),angular.module("panelApp").controller("expiredCtrl",["$scope","$state","authService",function(e,t,a){console.log("in expiredCtrl"),e.view={busy:!1,formError:!1},e.loginFormData={email:"",password:""},e.signinFormSubmit=function(){console.log("in signinFormSubmit()",e.loginFormData.email,e.loginFormData.password),e.view.busy=!0,e.view.formError=!1,a.login(e.loginFormData.email,e.loginFormData.password).then(function(a){e.view.busy=!1,1===a.usertype?t.go("campaigns"):t.go("apikeys")},function(){e.view.busy=!1,e.view.formError=!0})}}])}(),function(){"use strict";angular.module("panelApp").controller("campaignsCtrl",["$scope","$alert","$modal","errorHandler","campaignsService",function(e,t,a,n,i){var o=10;e.view={initialLoadComplete:!1,itemsPerPage:o,currentPage:1,maxSize:10,filtersActive:!1,campaignStatuses:[{code:-1,label:"Any status"},{code:0,label:"Incomplete"},{code:1,label:"Billing"},{code:2,label:"Prepared"},{code:3,label:"Live"},{code:4,label:"Completed"},{code:5,label:"Stopped"}]},e.view.statusFilterModel=e.view.campaignStatuses[0],e.data={campaignsCount:0,campaigns:[]},e.filters={},e.daterange={dates:{startDate:null,endDate:null},min:moment().format("YYYY-MM-DD")};var r=function(){s(),d()},s=function(){e.filters={name:"",client:"",media_title:"",start_date:"",end_date:"",status:void 0}};e.changePage=function(){d()},e.reloadCampaigns=function(){e.view.currentPage=1,d()};var d=function(t){var a={limit:o,offset:o*(e.view.currentPage-1)};e.filters.name.length>0&&(a.name=e.filters.name),e.filters.client.length>0&&(a.client=e.filters.client),e.filters.media_title.length>0&&(a.media_title=e.filters.media_title),e.filters.start_date.length>0&&(a.start_date=e.filters.start_date),e.filters.end_date.length>0&&(a.end_date=e.filters.end_date),"undefined"!=typeof e.filters.status&&(a.status=e.filters.status),i.getCampaigns(a).then(function(t){e.data.campaignsCount=t.count,e.data.campaigns=t.items,e.view.initialLoadComplete=!0},function(e){n.processApiResponse(e)})},c=function(e){var a=e.name;i.deleteCampaign(e.id).then(function(){t({title:"Campagin deleted.",content:'Campaign "'+a+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),d()},function(e){n.processApiResponse(e)})};e.startCampaign=function(e){var a=e.name;i.startCampaign(e.id).then(function(){t({title:"Campagin started.",content:'Campaign "'+a+'" is now live.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),d()},function(e){var a=_.findWhere(e.data.errorDetails.logicProcessing.processingErrors,{code:3});"undefined"!=typeof a?t({title:"Incorrect campaign settings.",content:"Please review your campaign settings then start the campaign",container:"#alerts-container",placement:"top",duration:3,type:"danger",show:!0}):n.processApiResponse(e)})};var l=function(e){var a=e.name;i.stopCampaign(e.id).then(function(){t({title:"Campagin stopped.",content:'Campaign "'+a+'" has been stopped.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),d()},function(e){n.processApiResponse(e)})};e.showCampaignDetails=function(e){a({templateUrl:"panel-module/components/campaignDetailsModal/modalTmpl.html",controller:"campaignDetailsModalCtrl",animation:"am-fade-and-scale",resolve:{campaignId:function(){return e}}})},e.showDeleteCampaignDialog=function(e){var t={delete:function(e){console.log("delete camapgin",e),c(e)}};a({templateUrl:"panel-module/components/campaignDeleteModal/modalTmpl.html",controller:"campaignDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return t},campaign:function(){return e}}})},e.showStopCampaignDialog=function(e){var t={stopCampaign:function(e){console.log("stop camapgin",e),l(e)}};a({templateUrl:templateDirUri+"/assets/js/panel-module/components/campaignStopModal/modalTmpl.html",controller:"campaignStopModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{callbacks:function(){return t},campaign:function(){return e}}})},e.updateFilters=function(){e.filters.status=e.view.statusFilterModel.code===-1?void 0:e.view.statusFilterModel.code,e.reloadCampaigns()},e.$watch("daterange.dates.startDate",function(t,a){null!==t&&(e.filters.start_date=moment(e.daterange.dates.startDate).format("YYYY-MM-DD"),e.filters.end_date=moment(e.daterange.dates.endDate).format("YYYY-MM-DD"),e.updateFilters())}),e.toggleFilters=function(){e.view.filtersActive?e.clearFilters():e.view.filtersActive=!0},e.clearFilters=function(){e.view.filtersActive=!1,s(),e.reloadCampaigns()},r()}])}(),function(){"use strict";angular.module("panelApp").controller("profileCtrl",["$scope","$alert","$modal","$q","utils","errorHandler","userService",function(e,t,a,n,i,o,r){e.fieldHasError=i.fieldHasError,e.view={loading:!0,sending:!1,submitted:!1},e.data={user:{},countries:[]};var s=function(){var t=n.defer(),a=n.defer(),i=[t.promise,a.promise];r.getUser().then(function(a){e.data.user=a,t.resolve(a)},function(e){t.reject(e)}),r.getCountries().then(function(t){console.log("countries",t),e.data.countries=t,a.resolve(t)},function(e){a.reject(e)}),n.all(i).then(function(){e.view.loading=!1},function(e){o.processApiResponse(e)})};e.showErrors=function(){return e.view.submitted},e.showPasswordChangeDialog=function(){a({templateUrl:"panel-module/components/passwordChangeModal/modalTmpl.html",controller:"passwordChangeModalCtrl",animation:"am-fade-and-scale",placement:"center",backdrop:"static"})},e.saveProfile=function(){e.view.submitted=!0,e.form1.$valid&&(e.view.sending=!0,r.updateUser(e.data.user).then(function(){e.view.sending=!1,t({title:"Account settings saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(e){o.processApiResponse(e)}))},s()}])}(),function(){"use strict";angular.module("panelApp").controller("creditCardsCtrl",["$scope","$alert","$modal","errorHandler","billingService",function(e,t,a,n,i){e.view={busy:!0},e.data={cards:[]};var o=function(){e.view.busy=!0,r()},r=function(){i.getCards().then(function(t){e.data.cards=t,e.view.busy=!1},function(e){n.processApiResponse(e)})},s=function(e){i.deleteCard(e.payment_method_id).then(function(){t({title:"Your credit card has been deleted.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),r()},function(e){n.processApiResponse(e)})};e.setMainCard=function(e){i.setMainCard(e.payment_method_id).then(function(e){r()},function(e){n.processApiResponse(e)})},e.showDeleteCardDialog=function(e){var t={delete:function(e){console.log("delete card",e),s(e)}};a({templateUrl:"panel-module/components/cardDeleteModal/modalTmpl.html",controller:"cardDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{callbacks:function(){return t},card:function(){return e}}})},e.showNewCardDialog=function(){var e={cardAdded:function(e){console.log("new card",e),r()}};a({templateUrl:"panel-module/components/newCardModal/modalTmpl.html",controller:"newCardModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{callbacks:function(){return e}}})},o()}])}(),function(){"use strict";angular.module("panelApp").controller("addFundsCtrl",["$q","utils","$scope","$rootScope","errorHandler","$modal","billingService","userService",function(e,t,a,n,i,o,r,s){a.fieldHasError=t.fieldHasError,a.view={loading:!0,sending:!1,submitted:!1,checkoutSuccess:!1,checkoutFailure:!1,paymentDeclined:!1,mainCardError:!1,showBillingDetailsForm:!1},a.data={card:{masked_number:"",expiration_date:null},countries:[],user:{firstName:"",lastName:"",company:"",country:void 0,city:"",address:"",postalCode:""},amountsList:[500,250,100,50],creditsCustomAmount:null,checkoutCredits:0,checkoutTotal:0,creditValue:null};var d=function(){a.view.loading=!0;var t=e.defer(),n=e.defer(),o=e.defer(),d=e.defer(),l=[t.promise,n.promise,o.promise,d.promise];r.getMainCard().then(function(e){a.data.card=e,t.resolve(e)},function(e){a.view.mainCardError=!0,t.reject(e)}),s.getBalance().then(function(e){a.data.creditValue=1/e.cash_to_credits_conversion_ratio,n.resolve(a.data.creditValue)},function(e){n.reject(e)}),s.getUser().then(function(e){a.data.user={firstName:e.firstName,lastName:e.lastName,company:e.company,country:e.country,city:e.city,address:e.address,postalCode:e.postalCode},o.resolve(e)},function(e){o.reject(e)}),s.getCountries().then(function(e){a.data.countries=e,d.resolve(e)},function(e){d.reject(e)}),e.all(l).then(function(){c()||(a.view.showBillingDetailsForm=!0),a.view.loading=!1},function(e){a.view.mainCardError===!0?a.view.loading=!1:i.processApiResponse(e)})},c=function(){return""!==a.data.user.firstName&&(""!==a.data.user.lastName&&(""!==a.data.user.company&&(void 0!==a.data.user.country&&(""!==a.data.user.city&&(""!==a.data.user.address&&""!==a.data.user.postalCode)))))},l=function(){a.data.creditsCustomAmount=null,a.data.checkoutCredits=0,a.data.checkoutTotal=0},u=function(){a.view.checkoutSuccess=!1,a.view.checkoutFailure=!1};a.$watch(function(){return a.data.checkoutCredits},function(){a.data.checkoutTotal=a.data.checkoutCredits*a.data.creditValue,a.data.checkoutTotal>0&&u()}),a.showErrors=function(){return a.view.submitted},a.changeBillingDetails=function(){a.view.showBillingDetailsForm=!0},a.selectCreditsPreset=function(e){a.data.checkoutCredits=e,a.data.creditsCustomAmount=null},a.selectCreditsCustom=function(e){a.data.checkoutCredits=e},a.checkoutCancel=function(){l()},a.checkoutCconfirm=function(){a.view.showBillingDetailsForm&&!a.form1.$valid?a.view.submitted=!0:(a.view.sending=!0,a.view.showBillingDetailsForm=!1,s.updateUser(a.data.user).then(function(){r.buyCredits(a.data.card.payment_method_id,a.data.checkoutCredits).then(function(e){a.view.sending=!1,a.view.checkoutSuccess=!0,n.$broadcast("accountBalanceChanged"),l()},function(e){a.view.sending=!1,400===e.status&&"undefined"!=typeof e.data.error_code?1===e.data.error_code?a.view.checkoutFailure=!0:2===e.data.error_code&&(a.view.paymentDeclined=!0):i.processApiResponse(e),l()})},function(e){a.view.sending=!1,i.processApiResponse(e)}))},d()}])}(),function(){"use strict";angular.module("panelApp").controller("billingCtrl",["$scope","$modal","$filter","errorHandler","billingService","userService",function(e,t,a,n,i,o){var r=10;e.view={initialLoadComplete:!1,itemsPerPage:r,currentPage:1,maxSize:10},e.data={transactionsCount:0,transactions:[],user:{hasBillingDetails:!1}},e.filters={},e.daterange={dates:{startDate:null,endDate:null},datepickerLabel:"Select date range"};var s=function(){o.getUser().then(function(t){e.data.user.firstName=t.firstName,e.data.user.lastName=t.lastName,e.data.user.company=t.company,e.data.user.country=t.country,e.data.user.city=t.city,e.data.user.address=t.address,e.data.user.postalCode=t.postalCode,e.data.user.hasBillingDetails=d(),
c()},function(e){n.processApiResponse(e)})},d=function(){return""!==e.data.user.firstName&&(""!==e.data.user.lastName&&(""!==e.data.user.company&&(void 0!==e.data.user.country&&(""!==e.data.user.city&&(""!==e.data.user.address&&""!==e.data.user.postalCode)))))};e.changePage=function(){c()},e.reloadTransactions=function(){e.view.currentPage=1,c()};var c=function(){var t={limit:r,offset:r*(e.view.currentPage-1)};e.filters.start_date&&(t.start_date=e.filters.start_date),e.filters.end_date&&(t.end_date=e.filters.end_date),i.getTransactions(t).then(function(t){e.data.transactionsCount=t.count,e.data.transactions=t.results,e.view.initialLoadComplete=!0},function(e){n.processApiResponse(e)})};e.updateFilters=function(){e.reloadTransactions()},e.getInvoicePdf=function(e){var a=t({templateUrl:"/panel-module/components/invoiceDownloadModal/modalTmpl.html",animation:"am-fade-and-scale",placement:"center"});i.getInvoicePdf(e).then(function(e){a.$promise.then(a.hide)},function(e){n.processApiResponse(e),a.$promise.then(a.hide)})},e.$watch("daterange.dates.startDate",function(t,n){null!==t&&(e.filters.start_date=moment.utc(e.daterange.dates.startDate).hour(0).minute(0).second(0).format("YYYY-MM-DD"),e.filters.end_date=moment.utc(e.daterange.dates.endDate).hour(23).minute(59).second(59).format("YYYY-MM-DD"),e.daterange.datepickerLabel=a("date")(e.filters.start_date,"yyyy-MM-dd")+" - "+a("date")(e.filters.end_date,"yyyy-MM-dd"),e.updateFilters())}),s()}])}(),function(){"use strict";angular.module("panelApp").controller("apiKeysCtrl",["$scope","$alert","$modal","errorHandler","applicationsService",function(e,t,a,n,i){var o=10;e.view={busy:!0,currentPage:1,maxSize:10,itemsPerPage:o,filtersActive:!1,initialLoadComplete:!1},e.data={appsCount:0,apps:[]},e.filters={};var r=function(){s(),d()},s=function(){e.filters={name:"",api_key:""}};e.changePage=function(){d()},e.reloadApps=function(){e.view.currentPage=1,d()};var d=function(t){var a={limit:o,offset:o*(e.view.currentPage-1)};e.filters.name.length>0&&(a.name=e.filters.name),e.filters.api_key.length>0&&(a.api_key=e.filters.api_key),e.view.busy=!0,i.getApps(a).then(function(t){e.data.appsCount=t.count,e.data.apps=t.items,e.view.busy=!1,e.view.initialLoadComplete=!0},function(e){n.processApiResponse(e)})},c=function(e){var a=e.name;i.deleteApp(e.id).then(function(){t({title:"Application deleted.",content:'Application "'+a+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),d()},function(e){n.processApiResponse(e)})};e.showDeleteAppDialog=function(e){var t={delete:function(e){console.log("delete app",e),c(e)}};a({templateUrl:"panel-module/components/appDeleteModal/modalTmpl.html",controller:"appDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return t},app:function(){return e}}})},e.showNewAppDialog=function(){var n={submit:function(a){t({title:"Application added.",content:'Application "'+a.name+'" has been added.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),e.reloadApps()}};a({templateUrl:"panel-module/components/newAppModal/modalTmpl.html",controller:"newAppModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return n}}})},e.showAppEditDialog=function(n){var i={submit:function(a){t({title:"Application updated.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),e.reloadApps()}};a({templateUrl:"panel-module/components/appEditModal/modalTmpl.html",controller:"appEditModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return i},app:function(){return n}}})},e.showAppKeyDialog=function(e){a({templateUrl:"panel-module/components/appKeyModal/modalTmpl.html",controller:"appKeyModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{app:function(){return e}}})},e.updateFilters=function(){e.reloadApps()},e.toggleFilters=function(){e.view.filtersActive?e.clearFilters():e.view.filtersActive=!0},e.clearFilters=function(){e.view.filtersActive=!1,s(),e.reloadApps()},r()}])}(),function(){"use strict";angular.module("panelApp").controller("mediaCtrl",["$scope","$alert","$modal","errorHandler","mediaService",function(e,t,a,n,i){var o=9;e.view={busy:!0,currentPage:1,media:[],maxSize:10,searchPhrase:"",searchInput:"",orderByOptions:[{value:"name",label:"Order by title"},{value:"-date_added",label:"Newest first"}],orderBy:"-date_added",itemsPerPage:o,selectItem:!1},e.data={mediaCount:0,media:[]};var r=function(){s()};e.reloadMedia=function(){e.view.currentPage=1,s()},e.changeOrder=function(){e.view.currentPage=1,s()},e.search=function(){e.view.currentPage=1,e.view.searchPhrase=e.view.searchInput,s()},e.nextPage=function(){e.view.busy||e.data.media.length===e.data.mediaCount||(e.view.currentPage++,s())};var s=function(t){var a={limit:o,offset:o*(e.view.currentPage-1),ordering:e.view.orderBy};e.view.searchPhrase.length>0&&(a.name=e.view.searchPhrase),e.view.busy=!0,i.getMedia(a).then(function(t){e.data.mediaCount=t.count,1===e.view.currentPage?e.data.media=t.items:e.data.media=e.data.media.concat(t.items),e.view.busy=!1},function(t){e.view.busy=!1,n.processApiResponse(t),e.$hide()})},d=function(a){var o=a.name;i.deleteMedia(a.id).then(function(){t({title:"Media deleted.",content:'Media collection "'+o+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),e.reloadMedia()},function(e){n.processApiResponse(e)})};e.showNewMediaDialog=function(){var t={submit:function(t){console.log("mediaId",t),e.reloadMedia()}};a({templateUrl:"panel-module/components/newMediaModal/modalTmpl.html",controller:"newMediaModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return t}}})},e.showDeleteMediaDialog=function(e){var t={delete:function(e){console.log("delete media",e),d(e)}};a({templateUrl:"panel-module/components/mediaDeleteModal/modalTmpl.html",controller:"mediaDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return t},media:function(){return e}}})},r()}])}(),function(){"use strict";angular.module("panelApp").controller("mediaViewCtrl",["$scope","$state","$stateParams","$alert","$modal","$sce","errorHandler","mediaService",function(e,t,a,n,i,o,r,s){e.view={busy:!1},e.data={mediaId:a.mediaId,mediaItem:{}},e.videogular={sources:[]};var d=function(){e.view.busy=!0,s.getMediaItem(e.data.mediaId).then(function(t){e.data.mediaItem=t,e.setVideo(),e.view.mediaLoaded=!0,e.view.busy=!1},function(t){e.view.busy=!1,r.processApiResponse(t),e.$hide()})},c=function(e){var a=e.name;s.deleteMedia(e.id).then(function(){n({title:"Media deleted.",content:'Media collection "'+a+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),t.go("media")},function(e){r.processApiResponse(e)})};e.setVideo=function(){e.videogular.sources=[{src:o.trustAsResourceUrl(e.data.mediaItem.video),type:"video/mp4"}]},e.showDeleteMediaDialog=function(e){var t={delete:function(e){console.log("delete media",e),c(e)}};i({templateUrl:"panel-module/components/mediaDeleteModal/modalTmpl.html",controller:"mediaDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return t},media:function(){return e}}})},d()}])}(),function(){"use strict";angular.module("panelApp").controller("mediaEditCtrl",["$scope","$state","$stateParams","$alert","errorHandler","apiUrl","authToken","utils","mediaService","FileUploader",function(e,t,a,n,i,o,r,s,d,c){var l=e.uploader=new c({url:o+"/media/",method:"PATCH",headers:{Authorization:"Token "+r.get()}});e.fieldHasError=s.fieldHasError,e.view={busy:!1,uploading:!1,submitted:!1,mediaCreated:!1,videoUploadStarted:!1,videoUploadProgress:0,videoUploadComplete:!1,imageUploadStarted:!1,imageUploadProgress:0,imageUploadComplete:!1},e.data={mediaId:a.mediaId,mediaItem:{},videoFile:"",imageFile:"",newVideoAdded:!1,newImageAdded:!1},e.errors={video:{},image:{}};var u=function(){s.addUploaderTypeFilter(l,"video",{videoFilter:["video/mp4","video/ogg","video/webm","video/mov","video/avi","video/quicktime"]}),s.addUploaderTypeFilter(l,"display",{imageFilter:["image/png","image/jpg","image/jpeg"]}),e.view.busy=!0,d.getMediaItem(e.data.mediaId).then(function(t){e.data.mediaItem=t,e.data.imageFile=t.display,e.view.hasVideo=!0,e.view.mediaLoaded=!0,e.view.busy=!1},function(t){e.view.busy=!1,i.processApiResponse(t)})};l.onAfterAddingFile=function(t){s.cleanupUploaderQueue(l),"video"===t.alias&&(e.data.videoFile=t._file,e.data.newVideoAdded=!0),"display"===t.alias&&(e.data.imageFile=t._file,e.data.newImageAdded=!0,d.imageSizeHelper(t._file).then(function(t){d.imageSizeValid(t.width,t.height)?delete e.errors.image.size:e.errors.image.size=!0}))},l.onBeforeUploadItem=function(t){"video"===t.alias&&(e.view.videoUploadStarted=!0),"display"===t.alias&&(e.view.imageUploadStarted=!0),t.url=o+"/media/"+e.data.mediaId+"/"},l.onCompleteItem=function(t,a,n,i){"video"===t.alias&&(e.view.videoUploadComplete=!0),"display"===t.alias&&(e.view.imageUploadComplete=!0)},l.onProgressItem=function(t,a){"video"===t.alias&&(e.view.videoUploadProgress=a),"display"===t.alias&&(e.view.imageUploadProgress=a)},l.onCompleteAll=function(){e.view.mediaCreated=!0,n({title:"Media saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),t.go("media")},e.showErrors=function(){return e.view.submitted},e.videoHasError=function(){return e.data.newVideoAdded&&"object"!=typeof e.data.videoFile},e.imageHasError=function(){return!(!e.data.newImageAdded||"object"==typeof e.data.imageFile&&!e.errors.image.size)},e.saveMedia=function(){e.view.submitted=!0,!e.form1.$valid||e.imageHasError()||e.videoHasError()||(e.view.uploading=!0,d.updateMedia(e.data.mediaItem).then(function(){e.data.newVideoAdded||e.data.newImageAdded?l.uploadAll():(n({title:"Media saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),t.go("media"))},function(){}))},u()}])}(),function(){"use strict";angular.module("panelApp").controller("productsCtrl",["$scope","$alert","$modal","$http","apiUrl","authToken","errorHandler","productsService",function(e,t,a,n,i,o,r,s){var d=12;e.view={busy:!0,currentPage:1,media:[],maxSize:10,searchPhrase:"",searchInput:"",orderByOptions:[{value:"title",label:"Order by title"},{value:"-date_added",label:"Newest first"}],orderBy:"-date_added",itemsPerPage:d,selectItem:!1},e.data={deletedCount:0,productsCount:0,products:[]};var c=function(){l()};e.reloadProducts=function(){e.view.currentPage=1,l()},e.search=function(){e.view.currentPage=1,e.view.searchPhrase=e.view.searchInput,l()},e.nextPage=function(){e.view.busy||e.data.products.length===e.data.productsCount||(e.view.currentPage++,l())};var l=function(t){var a={limit:d,offset:d*(e.view.currentPage-1)-e.data.deletedCount,ordering:e.view.orderBy};e.view.searchPhrase.length>0&&(a.title=e.view.searchPhrase),e.view.busy=!0,s.getProducts(a).then(function(t){e.data.productsCount=t.count,1===e.view.currentPage?e.data.products=t.items:e.data.products=e.data.products.concat(t.items),e.view.busy=!1},function(t){e.view.busy=!1,r.processApiResponse(t),e.$hide()})},u=function(a,n){var i=a.title;s.deleteProduct(a.id).then(function(){t({title:"Product deleted.",content:'"'+i+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),e.data.products.splice(n,1),e.data.productsCount--,e.data.deletedCount++},function(e){r.processApiResponse(e)})};e.showNewProductDialog=function(){var t={submit:function(t){console.log("newProduct",t),e.reloadProducts()}};a({templateUrl:"panel-module/components/newProductModal/modalTmpl.html",controller:"newProductModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return t}}})},e.showDeleteProductDialog=function(e,t){var n={delete:function(e,t){u(e,t)}};a({templateUrl:"panel-module/components/productDeleteModal/modalTmpl.html",controller:"productDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return n},product:function(){return e},index:function(){return t}}})},c()}])}(),function(){"use strict";angular.module("panelApp").controller("productViewCtrl",["$scope","$state","$stateParams","$alert","$modal","errorHandler","productsService",function(e,t,a,n,i,o,r){e.view={busy:!1},e.data={productId:a.productId,product:{}};var s=function(){e.view.busy=!0,r.getProduct(e.data.productId).then(function(t){console.log(t),e.data.product=t,e.view.busy=!1},function(t){e.view.busy=!1,o.processApiResponse(t),e.$hide()})},d=function(e){var a=e.title;r.deleteProduct(e.id).then(function(){n({title:"Product deleted.",content:'"'+a+'" has been deleted.',container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),t.go("products")},function(e){o.processApiResponse(e)})};e.showDeleteProductDialog=function(e){var t={delete:function(e){d(e)}};i({templateUrl:"panel-module/components/productDeleteModal/modalTmpl.html",controller:"productDeleteModalCtrl",animation:"am-fade-and-scale",placement:"center",resolve:{modalOptions:function(){return t},product:function(){return e}}})},s()}])}(),function(){"use strict";angular.module("panelApp").controller("productEditCtrl",["$scope","$state","$stateParams","$alert","apiUrl","utils","authToken","errorHandler","FileUploader","productsService",function(e,t,a,n,i,o,r,s,d,c){var l=e.uploader=new d({method:"PATCH",headers:{Authorization:"Token "+r.get()}});e.fieldHasError=o.fieldHasError,e.urlRegex=o.urlRegex(),e.view={busy:!1,submitted:!1,uploading:!1,uploadStarted:!1,uploadProgress:0,uploadComplete:!1},e.data={productId:a.productId,product:{},imageFile:"",newImageAdded:!1};var u=function(){o.addUploaderTypeFilter(l,"image",{imageFilter:["image/png","image/jpg","image/jpeg"]}),e.view.busy=!0,c.getProduct(e.data.productId).then(function(t){e.data.product=t,e.data.imageFile=t.image||t.image_url,e.view.busy=!1},function(t){e.view.busy=!1,s.processApiResponse(t),e.$hide()})},p=function(){n({title:"Product saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0}),t.go("products")};l.onAfterAddingFile=function(t){o.cleanupUploaderQueue(l),e.data.imageFile=t._file,e.data.newImageAdded=!0},l.onBeforeUploadItem=function(t){e.view.uploading=!0,e.view.uploadStarted=!0,t.url=i+"/products/"+e.data.productId+"/"},l.onProgressItem=function(t,a){e.view.uploadProgress=a},l.onSuccessItem=function(t,a,n,i){e.view.uploadComplete=!0,p()},e.showErrors=function(){return e.view.submitted},e.imageHasError=function(){return e.data.newImageAdded&&"object"!=typeof e.data.imageFile},e.saveProduct=function(){e.view.submitted=!0,e.form1.$valid&&(e.view.uploading=!0,c.updateProduct(e.data.product).then(function(){e.data.newImageAdded?l.uploadAll():p()},function(){}))},u()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorCtrl",["$scope","$state","$stateParams","campaignEditorService",function(e,t,a,n){var i=n;e.logData=function(){i.logData()},i.init(a.campaignId),e.currentStep=i.currentStep,e.states={step1:"campaigns."+i.mode()+".step1",step2:"campaigns."+i.mode()+".step2",step3:"campaigns."+i.mode()+".step3",step4:"campaigns."+i.mode()+".step4",step5:"campaigns."+i.mode()+".step5",step6:"campaigns."+i.mode()+".step6"},t.go(e.states.step1)}])}(),function(){"use strict";angular.module("panelApp").controller("editCampaignCtrl",["$scope","$state","$stateParams","campaignEditorService","campaignsService","errorHandler","$alert",function(e,t,a,n,i,o,r){var s=n;s.init(a.campaignId),e.view={currentTab:"details"},e.data={campaign:{}},i.getCampaign(a.campaignId).then(function(a){3===a.status&&t.go("campaigns"),e.data.campaign=a},function(e){o.processApiResponse(e)}),e.switchTab=function(t){e.view.currentTab=t},e.isCurrentTab=function(t){return e.view.currentTab===t}}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep1Ctrl",["$scope","$state","$stateParams","errorHandler","campaignEditorService","utils",function(e,t,a,n,i,o){var r=i;e.fieldHasError=o.fieldHasError,e.view={busy:!0},e.campaign={},e.daterange={dates:{startDate:null,endDate:null},min:moment().format("YYYY-MM-DD"),display:"Select date range"};var s=function(){r.currentStep("step1"),r.previousState("campaigns."+r.mode()+".step1"),e.campaign=r.dataGet("campaign"),"undefined"!=typeof e.campaign.start_date&&"undefined"!=typeof e.campaign.end_date&&(e.daterange.dates.startDate=moment.utc(e.campaign.start_date),e.daterange.dates.endDate=moment.utc(e.campaign.end_date),e.daterange.display=e.daterange.dates.startDate.format("YYYY-MM-DD")+" - "+e.daterange.dates.endDate.format("YYYY-MM-DD")),e.view.busy=!1};e.$watch(function(){return e.daterange.dates},function(t,a){void 0!==t&&null!==t.startDate&&null!==t.endDate&&(e.daterange.display=t.startDate.format("YYYY-MM-DD")+" - "+t.endDate.format("YYYY-MM-DD"))}),e.showErrors=function(){return r.stepGet("step1","submitted")},e.nextStep=function(){r.stepSet("step1","submitted",!0),e.form1.$valid?(r.stepSet("step1","valid",!0),e.campaign.start_date=moment(e.daterange.dates.startDate).format("YYYY-MM-DD")+"T00:00:00.000Z",e.campaign.end_date=moment(e.daterange.dates.endDate).format("YYYY-MM-DD")+"T23:59:59.999Z",r.dataSet("campaign",e.campaign),r.save("step1").then(function(){t.go("campaigns."+r.mode()+".step2")},function(e){n.processApiResponse(e)})):r.stepSet("step1","valid",!1)},e.logControllerData=function(){console.log("campaignEditorStep1Ctrl - campaign",angular.copy(e.campaign))},s()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep2Ctrl",["$scope","$state","$sce","utils","$modal","errorHandler","campaignsService","campaignEditorService",function(e,t,a,n,i,o,r,s){var d=s;e.fieldHasError=n.fieldHasError,e.view={busy:!1,showErrors:!1,errors:{},ageRanges:[]},e.data={allCategories:!0,allLocations:!0,categories:[],locations:[],gender:{male:!0,female:!0},os:{ios:!0,android:!0},ageRange:void 0};var c=function(){d.stepGet("step1","valid")||t.go(d.previousState()),d.currentStep("step2"),d.previousState("campaigns."+d.mode()+".step2");var a=d.dataGet("targeting");_.isEmpty(a)?(e.view.busy=!0,r.getTargeting().then(function(t){e.data.allCategories=t.allCategories,e.data.allLocations=t.allLocations,e.data.categories=t.categories,e.data.locations=t.locations,e.data.gender=t.gender,e.data.os=t.os,e.data.ageRange=t.ageRange,e.view.ageRanges=t.ageRanges,e.view.busy=!1},function(e){o.processApiResponse(e)})):e.data=a};e.nextStep=function(){e.view.busy=!0,d.stepSet("step2","submitted",!0),r.saveTargeting(d.dataGet("campaignId"),e.data).then(function(a){d.stepSet("step2","valid",!0),d.dataSet("targeting",e.data),t.go("campaigns."+d.mode()+".step3")},function(t){e.view.busy=!1,d.stepSet("step2","valid",!1),"object"!=typeof t||_.isEmpty(t.validationErrors)?o.processApiResponse(t):(e.view.showErrors=!0,e.view.errors=t.validationErrors)})},e.previousStep=function(){t.go("campaigns."+d.mode()+".step1")},e.resetError=function(t){"undefined"!=typeof e.view.errors[t]&&delete e.view.errors[t]},c()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep3Ctrl",["$scope","$state","utils","errorHandler","campaignsService","campaignEditorService","$timeout",function(e,t,a,n,i,o,r){var s=o;e.fieldHasError=a.fieldHasError,e.hasBudget=!1,e.view={busy:!1,showCharts:!1},e.data={budgetType:"ongoing",bidAmount:void 0,budgetAmount:void 0},e.estViews={daily:{percentage:0,min:0,max:0},total:{percentage:0,min:0,max:0}},e.estDailyViewsChart={data:[e.estViews.daily.percentage,100-e.estViews.daily.percentage],labels:["",""],colours:["#f9cd3f","#dae2e5"],options:{animationEasing:"easeOutQuart",showTooltips:!1,segmentShowStroke:!1,percentageInnerCutout:85}},e.estTotalViewsChart={data:[e.estViews.total.percentage,100-e.estViews.total.percentage],labels:["",""],colours:["#343b45","#dae2e5"],options:{animationEasing:"easeOutQuart",showTooltips:!1,segmentShowStroke:!1,percentageInnerCutout:85}};var d=function(e){var t=["ongoing","fixed","daily"];return"number"==typeof e?t[e-1]:"string"==typeof e?(e=t.indexOf(e),e+1):void 0},c=function(){s.stepGet("step1","valid")&&s.stepGet("step2","valid")||t.go(s.previousState()),s.currentStep("step3"),s.previousState("campaigns."+s.mode()+".step3");var a=s.dataGet("budgeting");_.isEmpty(a)?r(function(){l()},300):(e.data=a,e.hasBudget=!0,r(function(){l()},300))};e.changedBid=function(){l()};var l=function(){"undefined"==typeof e.data.bidAmount?(e.estViews={daily:{percentage:0,min:0,max:0},total:{percentage:0,min:0,max:0}},u(),e.view.showCharts=!0):i.getEstimatedViews(s.dataGet("campaignId"),e.data.bidAmount).then(function(t){e.estViews=t,u(),e.view.showCharts=!0},function(e){n.processApiResponse(e)})},u=function(){e.estDailyViewsChart.data=[e.estViews.daily.percentage,100-e.estViews.daily.percentage],e.estTotalViewsChart.data=[e.estViews.total.percentage,100-e.estViews.total.percentage]};e.showErrors=function(){return s.stepGet("step3","submitted")},e.previousStep=function(){t.go("campaigns."+s.mode()+".step2")},e.nextStep=function(){if(s.stepSet("step3","submitted",!0),e.form1.$valid){e.view.busy=!0;var a={cost_per_view:e.data.bidAmount,amount:e.data.budgetAmount,type:d(e.data.budgetType)};"ongoing"===e.data.budgetType&&(a.amount=0),i.saveCampaignBudget(s.dataGet("campaignId"),a,e.hasBudget).then(function(a){s.stepSet("step3","valid",!0),s.dataSet("budgeting",e.data),t.go("campaigns."+s.mode()+".step4")},function(e){n.processApiResponse(e)})}},c()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep4Ctrl",["$scope","$state","$sce","utils","$modal","errorHandler","mediaService","campaignEditorService",function(e,t,a,n,i,o,r,s){var d=s;e.fieldHasError=n.fieldHasError,e.videogular={sources:[]},e.videogularApi=null;var c=function(){d.stepGet("step1","valid")&&d.stepGet("step2","valid")&&d.stepGet("step3","valid")||t.go(d.previousState()),d.currentStep("step4"),d.previousState("campaigns."+d.mode()+".step4"),e.media=d.dataGet("media"),e.view={busy:!1,busyMedia:!1,mediaLoaded:!1,playerReady:!1,videoSet:!1},l()&&(e.view.mediaLoaded=!0,e.view.playerReady&&e.setVideo())},l=function(){return"string"==typeof e.media.video};e.hasMedia=function(){return 0!==Object.getOwnPropertyNames(e.media).length},e.onPlayerReady=function(t){e.videogularApi=t,l()&&!e.view.videoSet&&e.setVideo()},e.setVideo=function(){e.videogularApi.stop(),e.videogular.sources=[{src:a.trustAsResourceUrl(e.media.video),type:"video/mp4"}],e.view.videoSet=!0},e.showMediaLibrary=function(){var t={submit:function(t){e.getMedia(t.id)}};i({templateUrl:"panel-module/components/mediaLibraryModal/modalTmpl.html",controller:"mediaLibraryModalCtrl",animation:"am-fade-and-scale",resolve:{modalOptions:function(){return t}}})},e.showNewMediaDialog=function(){var t={mode:"campaignEditor",submit:function(t){console.log("mediaId",t),e.getMedia(t)}};i({templateUrl:"panel-module/components/newMediaModal/modalTmpl.html",controller:"newMediaModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return t}}})},e.getMedia=function(t){e.view.busyMedia=!0,r.getMediaItem(t).then(function(t){e.media=t,e.view.busyMedia=!1,e.setVideo(),e.view.mediaLoaded=!0},function(){e.view.busyMedia=!1})},e.showErrors=function(){return d.stepGet("step4","submitted")},e.previousStep=function(){t.go("campaigns."+d.mode()+".step3")},e.nextStep=function(){d.stepSet("step4","submitted",!0),e.form1.$valid?(d.stepSet("step4","valid",!0),d.dataSet("media",e.media),d.save("step4").then(function(){t.go("campaigns."+d.mode()+".step5")},function(e){o.processApiResponse(e)})):d.stepSet("step4","valid",!1)},e.logControllerData=function(){console.log("campaignEditorStep1Ctrl - media",angular.copy(e.media))},c()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep5Ctrl",["$scope","$state","utils","$modal","errorHandler","campaignsService","campaignEditorService","productsService",function(e,t,a,n,i,o,r,s){var d=r;e.fieldHasError=a.fieldHasError,e.urlRegex=a.urlRegex(),e.products=[],e.recommendedProducts=[],e.carouselOptions={nav:!0,dots:!1,navText:['<span class="glyphicon glyphicon-chevron-left"></span>','<span class="glyphicon glyphicon-chevron-right"></span>'],navRewind:!1,loop:!1,items:4};var c=function(){d.stepGet("step1","valid")&&d.stepGet("step2","valid")&&d.stepGet("step3","valid")&&d.stepGet("step4","valid")||t.go(d.previousState()),d.currentStep("step5"),d.previousState("campaigns."+d.mode()+".step5"),e.products=d.dataGet("products"),s.getProducts({limit:16,offset:0,ordering:"-last_used_date"}).then(function(t){e.recommendedProducts=t.items}),e.view={busy:!1,submitted:!1}};e.hasProducts=function(){return!_.isEmpty(e.products)},e.showErrors=function(){return d.stepGet("step5","submitted")},e.skipStep=function(){d.stepSet("step5","submitted",!0),d.stepSet("step5","valid",!0),t.go("campaigns."+d.mode()+".step6")},e.previousStep=function(){t.go("campaigns."+d.mode()+".step4")},e.nextStep=function(){d.stepSet("step5","submitted",!0),e.form1.$valid?(d.stepSet("step5","valid",!0),d.dataSet("products",e.products),d.save("step5").then(function(){t.go("campaigns."+d.mode()+".step6")},function(e){i.processApiResponse(e)})):d.stepSet("step5","valid",!1)},e.selectRecommendedProduct=function(t){e.products.unshift(t)},e.showProductsLibrary=function(){var t={submit:function(t){e.products.unshift(t)}};n({templateUrl:"/panel-module/components/producstLibraryModal/modalTmpl.html",controller:"producstLibraryModalCtrl",animation:"am-fade-and-scale",resolve:{modalOptions:function(){return t}}})},e.showNewProductDialog=function(){var t={mode:"campaignEditor",submit:function(t){console.log("newProduct",t),e.products.unshift(t)}};n({templateUrl:"/panel-module/components/newProductModal/modalTmpl.html",controller:"newProductModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return t}}})},e.removeProduct=function(t){e.products.splice(t,1)},e.logControllerData=function(){console.log("campaignEditorStep1Ctrl - products",angular.copy(e.products))},c()}])}(),function(){"use strict";angular.module("panelApp").controller("campaignEditorStep6Ctrl",["$scope","$state","$sce","utils","$modal","campaignsService","campaignEditorService","errorHandler",function(e,t,a,n,i,o,r,s){var d=r;e.videogularApi=null,e.campaign={},e.media={},e.products=[],e.videogular={sources:[]},e.view={loading:!0,playerReady:!1,videoSet:!1};var c=function(){d.stepGet("step1","valid")&&d.stepGet("step2","valid")&&d.stepGet("step3","valid")&&d.stepGet("step4","valid")&&d.stepGet("step5","valid")||t.go(d.previousState()),d.currentStep("step6"),d.previousState("campaigns."+d.mode()+".step6"),e.campaignId=d.dataGet("campaignId"),e.view.loading=!0,o.getCampaign(e.campaignId).then(function(t){e.campaign=t,t.media.length>0&&"object"==typeof t.media[0]&&(e.media=t.media[0]),t.products.length>0&&(e.products=t.products),e.view.loading=!1},function(e){s.processApiResponse(e)})};e.onPlayerReady=function(t){e.videogularApi=t,e.view.playerReady=!0,e.setVideo()},e.setVideo=function(){e.videogularApi.stop(),e.videogular.sources=[{src:a.trustAsResourceUrl(e.media.video),type:"video/mp4"}],e.view.videoSet=!0},e.previousStep=function(){t.go("campaigns."+d.mode()+".step5")},e.finish=function(){o.setPrepared(e.campaignId).then(function(e){t.go("campaigns")},function(e){s.processApiResponse(e)})},e.hasProducts=function(){return e.products.length>0},e.logControllerData=function(){console.log("campaignEditorStep1Ctrl - media",angular.copy(e.campaign),angular.copy(e.media),angular.copy(e.products))},c()}])}(),function(){"use strict";angular.module("panelApp").factory("permissionsService",["statePermissions","authService",function(e,t){var a=function(a){var n=t.getUsertype();return _.contains(e[n],a)};return{userHasAccess:a}}])}(),function(){"use strict";angular.module("panelApp").factory("campaignEditorService",["$q","campaignsService","clientsService","productsService",function(e,t,a,n){var i={},o={},r={},s=function(e){i={currentStep:"step1",previousState:"campaigns.new.step1",step1:{valid:!1,submitted:!1},step2:{valid:!1,submitted:!1},step3:{valid:!1,submitted:!1},step4:{valid:!1,submitted:!1},step5:{valid:!1,submitted:!1},step6:{valid:!1,submitted:!1}},o={campaignId:void 0,campaign:{name:void 0,start_date:void 0,end_date:void 0,budget:void 0},targeting:{},media:{},products:[]},r={mode:"new",campaignLoaded:!1},"undefined"!=typeof e&&(c("mode","edit"),f("campaignId",e))},d=function(){return r.mode},c=function(e,t){return"undefined"==typeof t?"undefined"!=typeof r[e]&&r[e]:void(r[e]=t)},l=function(e){return"string"!=typeof e?i.currentStep:void(i.currentStep=e)},u=function(e){return"string"!=typeof e?i.previousState:void(i.previousState=e)},p=function(e,t){return"string"==typeof e&&("string"==typeof t?angular.copy(i[e][t]):angular.copy(i[e]))},m=function(e,t,a){return"string"==typeof e&&"string"==typeof t&&"undefined"!=typeof a&&(i[e][t]=a,p(e))},g=function(e){return"undefined"!=typeof e?"undefined"!=typeof o[e]&&angular.copy(o[e]):angular.copy(o)},f=function(e,t){return"string"==typeof e&&"undefined"!=typeof t&&(o[e]=t,g())},v=function(e){return"step1"===e?h():"step2"===e?y():"step3"===e?C():"step4"===e?b():"step5"===e?A():void 0},h=function(){var t=e.defer();g("campaign");return w(t),t.promise},w=function(e){var a=g("campaign"),n={name:a.name,start_date:a.start_date,end_date:a.end_date,budget:a.budget};g("campaignId")&&(n.id=g("campaignId")),t.saveCampagin(n).then(function(t){f("campaignId",t.id),e.resolve(g("campaign"))},function(t){e.reject(t)})},y=function(){var t=e.defer();return w(t),t.promise},C=function(){var t=e.defer();return w(t),t.promise},b=function(){var a=e.defer(),n=g("media"),i={campaignId:g("campaignId"),media:n.id,media_title:n.media_title,media_description:n.media_description};return t.saveMedia(i).then(function(){a.resolve()},function(e){a.reject(e)}),a.promise},A=function(){var a=e.defer(),i=g("campaignId"),o=g("products");return n.updateProducts(o).then(function(){t.saveProducts(i,o).then(function(e){a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)}),a.promise},E=function(){console.log("campaignEditorService - data",angular.copy(o))};return{init:s,flag:c,mode:d,save:v,currentStep:l,previousState:u,stepGet:p,stepSet:m,dataGet:g,dataSet:f,logData:E}}])}(),function(){"use strict";angular.module("panelApp").factory("campaignsService",["$q","apiService",function(e,t){var a=function(a){var n=e.defer(),i={limit:10,offset:0,ordering:"-id"};return"object"==typeof a&&("limit"in a&&(i.limit=a.limit),"offset"in a&&(i.offset=a.offset),"ordering"in a&&(i.ordering=a.ordering),"name"in a&&(i.name=a.name),"client"in a&&(i.client=a.client),"media_title"in a&&(i.media_title=a.media_title),"start_date"in a&&(i.start_date=a.start_date),"end_date"in a&&(i.end_date=a.end_date),"status"in a&&(i.status=a.status)),t.get("/campaigns/",i,!0).then(function(e){console.log("getCampaigns() success",e),n.resolve({count:e.count,items:e.results})},function(e){console.log("getCampaigns() failure",e),n.reject(e)}),n.promise},n=function(a){var n=e.defer();return t.get("/campaigns/"+a+"/",!1,!0).then(function(e){console.log("getCampaign() success",e),n.resolve(e)},function(e){console.log("getCampaign() failure",e),n.reject(e)}),n.promise},i=function(a){var n=e.defer();return t.delete("/campaigns/"+a+"/",!1,!0).then(function(e){console.log("deleteCampaign() success",e),n.resolve(e)},function(e){console.log("deleteCampaign() failure",e),n.reject(e)}),n.promise},o=function(e){return d(e,5)},r=function(e){return d(e,3)},s=function(e){return d(e,2)},d=function(a,n){var i=e.defer(),o={status:n};return t.put("/campaigns/"+a+"/status/",o,!0).then(function(e){i.resolve(e)},function(e){i.reject(e);
}),i.promise},c=function(a){var n=e.defer();return"undefined"==typeof a.id?t.post("/campaigns/",a,!0).then(function(e){console.log("saveCampaign() success",e),n.resolve(e)},function(e){console.log("saveCampaign() failure",e),n.reject(e)}):t.patch("/campaigns/"+a.id+"/",a,!0).then(function(e){console.log("saveCampaign() success",e),n.resolve(e)},function(e){console.log("saveCampaign() failure",e),n.reject(e)}),n.promise},l=function(a){var n=e.defer(),i=a.campaignId;return delete a.campaignId,t.patch("/campaigns/"+i+"/media/",a,!0).then(function(e){console.log("saveMedia() success",e),n.resolve(e)},function(e){console.log("saveMedia() failure",e),n.reject(e)}),n.promise},u=function(a,n){var i=e.defer(),o={products:[]};return angular.forEach(n,function(e){o.products.push(e.id)}),t.patch("/campaigns/"+a+"/products/",o,!0).then(function(e){console.log("saveProducts() success",e),i.resolve(e)},function(e){console.log("saveProducts() failure",e),i.reject(e)}),i.promise},p=function(a){var n=e.defer();return t.get("/countries/",null,!0).then(function(e){var t=!0,i=[];angular.forEach(e,function(e,n){n=parseInt(n);var o={id:n,name:e,selected:!0};"undefined"!=typeof a&&a.indexOf(n)===-1&&(o.selected=!1,t=!1),i.push(o)}),n.resolve({allLocations:t,locations:i})},function(e){n.reject(e)}),n.promise},m=function(a){var n=e.defer();return t.get("/campaigns/categories/",null,!0).then(function(e){var t=!0,i=[];angular.forEach(e,function(e,n){n=parseInt(n);var o={id:n,name:e,selected:!0};"undefined"!=typeof a&&a.indexOf(n)===-1&&(o.selected=!1,t=!1),i.push(o)}),n.resolve({allCategories:t,categories:i})},function(e){n.reject(e)}),n.promise},g=function(){return[{value:0,label:"Any"},{value:2130,label:"21 - 30"},{value:3145,label:"31 - 45"},{value:4660,label:"46 - 60"},{value:6180,label:"61 - 80"}]},f=function(a){var n=e.defer(),i=e.defer(),o=e.defer(),r=[i.promise,o.promise],s={gender:{},os:{}};return"undefined"==typeof a?(m().then(function(e){s.allCategories=e.allCategories,s.categories=e.categories,i.resolve()},function(e){i.reject(e)}),p().then(function(e){s.allLocations=e.allLocations,s.locations=e.locations,o.resolve()},function(e){o.reject(e)}),e.all(r).then(function(){s.gender={male:!0,female:!0},s.os={android:!0,ios:!0},s.ageRanges=g(),s.ageRange=s.ageRanges[0],n.resolve(s)},function(e){n.reject(e)})):t.get("/campaigns/"+a+"/targeting_options/",!1,!0).then(function(t){m(t.app_categories).then(function(e){s.allCategories=e.allCategories,s.categories=e.categories,i.resolve()},function(e){i.reject(e)}),p(t.location).then(function(e){s.allLocations=e.allLocations,s.locations=e.locations,o.resolve()},function(e){o.reject(e)}),e.all(r).then(function(){if(s.gender.male="M"===t.gender||"A"===t.gender,s.gender.female="F"===t.gender||"A"===t.gender,s.os.android=1===t.os||0===t.os,s.os.ios=2===t.os||0===t.os,s.ageRanges=g(),t.age_range.length>1)s.ageRange=s.ageRanges[0];else{var e=t.age_range[0];s.ageRange=_.findWhere(s.ageRanges,{value:e})}n.resolve(s)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},v=function(a,n){var i=e.defer(),o={},r={validationErrors:{}};return n.os.android===!0&&n.os.ios===!0?o.os=0:n.os.android===!0?o.os=1:n.os.ios===!0?o.os=2:r.validationErrors.os=!0,n.gender.male===!0&&n.gender.female===!0?o.gender="A":n.gender.male===!0?o.gender="M":n.gender.female===!0?o.gender="F":r.validationErrors.gender=!0,0===n.ageRange.value?(o.age_range=[],angular.forEach(g(),function(e){0!==e.value&&o.age_range.push(e.value)})):o.age_range=[n.ageRange.value],o.location=[],angular.forEach(n.locations,function(e){n.allLocations!==!0&&e.selected!==!0||o.location.push(e.id)}),0===o.location.length&&(r.validationErrors.locations=!0),o.app_categories=[],angular.forEach(n.categories,function(e){n.allCategories!==!0&&e.selected!==!0||o.app_categories.push(e.id)}),0===o.app_categories.length&&(r.validationErrors.categories=!0),_.isEmpty(r.validationErrors)?t.put("/campaigns/"+a+"/targeting_options/",o,!0).then(function(e){i.resolve(e)},function(e){i.reject(e)}):i.reject(r),i.promise},h=function(a,n){var i=e.defer(),o={};return"undefined"!=typeof n&&(o.cpv=n),t.get("/campaigns/"+a+"/estimated_views/",o,!0).then(function(e){console.log("getEstimatedViews() success",e),i.resolve(e)},function(e){console.log("getEstimatedViews() failure",e),i.reject(e)}),i.promise},w=function(a){var n=e.defer();return t.get("/campaigns/"+a+"/budget/",null,!0).then(function(e){console.log("getCampaignBudget() success",e),n.resolve(e.results[0])},function(e){console.log("getCampaignBudget() failure",e),n.reject(e)}),n.promise},y=function(a,n,i,o){var r=e.defer();return i?t.put("/campaigns/"+a+"/budget/"+o+"/",n,!0).then(function(e){console.log("saveCampaignBudget() success",e),r.resolve(e)},function(e){console.log("saveCampaignBudget() failure",e),r.reject(e)}):t.post("/campaigns/"+a+"/budget/",n,!0).then(function(e){console.log("saveCampaignBudget() success",e),r.resolve(e)},function(e){console.log("saveCampaignBudget() failure",e),r.reject(e)}),r.promise};return{getCampaigns:a,getCampaign:n,saveCampagin:c,deleteCampaign:i,saveProducts:u,saveMedia:l,stopCampaign:o,startCampaign:r,setPrepared:s,saveTargeting:v,getTargeting:f,getEstimatedViews:h,getCampaignBudget:w,saveCampaignBudget:y}}])}(),function(){"use strict";angular.module("panelApp").factory("clientsService",["$q","apiService",function(e,t){var a=function(){var a=e.defer();return t.get("/clients/",!1,!0).then(function(e){console.log("getClients() success",e),a.resolve(e)},function(e){console.log("getClients() failure",e),a.reject(e)}),a.promise},n=function(n){var i=e.defer(),o={name:n};return t.post("/clients/",o,!0).then(function(e){console.log("saveClient() success",e),a().then(function(t){i.resolve(e,t)},function(e){i.reject(e)})},function(e){console.log("saveClient() failure",e),i.reject(e)}),i.promise};return{getClients:a,saveClient:n}}])}(),function(){"use strict";angular.module("panelApp").factory("mediaService",["$q","apiService",function(e,t){var a=function(a){var n=e.defer(),i={limit:6,offset:0,ordering:"name"};return"object"==typeof a&&("limit"in a&&(i.limit=a.limit),"offset"in a&&(i.offset=a.offset),"ordering"in a&&(i.ordering=a.ordering),"name"in a&&(i.name=a.name)),t.get("/media/",i,!0).then(function(e){console.log("getMedia() success",e),n.resolve({count:e.count,items:e.results})},function(e){console.log("getMedia() failure",e),n.reject(e)}),n.promise},n=function(a){var n=e.defer();return t.get("/media/"+a+"/",!1,!0).then(function(e){console.log("getMediaItem() success",e),n.resolve(e)},function(e){console.log("getMediaItem() failure",e),n.reject(e)}),n.promise},i=function(a){var n=e.defer();return t.delete("/media/"+a+"/",!1,!0).then(function(e){console.log("deleteMedia() success",e),n.resolve(e)},function(e){console.log("deleteMedia() failure",e),n.reject(e)}),n.promise},o=function(a){var n=e.defer(),i={name:a};return t.post("/media/",i,!0).then(function(e){console.log("getMediaItem() success",e),n.resolve(e)},function(e){console.log("getMediaItem() failure",e),n.reject(e)}),n.promise},r=function(a){var n=e.defer(),i={name:a.name};return t.patch("/media/"+a.id+"/",i,!0).then(function(e){console.log("updateMedia() success",e),n.resolve(e)},function(e){console.log("updateMedia() failure",e),n.reject(e)}),n.promise},s=function(t){var a=e.defer(),n=new FileReader;return n.readAsDataURL(t),n.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){a.resolve({width:this.width,height:this.height})}},a.promise},d=function(e,t){return 1280===e&&1200===t};return{getMedia:a,getMediaItem:n,deleteMedia:i,createMedia:o,updateMedia:r,imageSizeHelper:s,imageSizeValid:d}}])}(),function(){"use strict";angular.module("panelApp").factory("productsService",["$http","$q","apiService",function(e,t,a){var n=function(e){var n=t.defer(),i={limit:6,offset:0,ordering:"title"};return"object"==typeof e&&("limit"in e&&(i.limit=e.limit),"offset"in e&&(i.offset=e.offset),"ordering"in e&&(i.ordering=e.ordering),"title"in e&&(i.title=e.title)),a.get("/products/",i,!0).then(function(e){console.log("getProducts() success",e),n.resolve({count:e.count,items:e.results})},function(e){console.log("getProducts() failure",e),n.reject(e)}),n.promise},i=function(e){var n=t.defer();return a.get("/products/"+e+"/",!1,!0).then(function(e){console.log("getProduct() success",e),n.resolve(e)},function(e){console.log("getProduct() failure",e),n.reject(e)}),n.promise},o=function(a){var n=t.defer();return e({url:"http://search.ulab.com/wrapper/get_data",method:"POST",data:{url:"http://staging.shopide.com/api/v1/products?search="+encodeURIComponent(a.search)+"&page="+a.page+"&per="+a.per,type:"GET"},headers:{Accept:"application/vnd.ulab.v0+json"}}).then(function(e){console.log("searchExternalProducts() success",e),n.resolve(JSON.parse(e.data.data))},function(e){console.log("searchExternalProducts() failure",e),n.reject(e)}),n.promise},r=function(e){var n=t.defer();return a.delete("/products/"+e+"/",!1,!0).then(function(e){console.log("deleteProduct() success",e),n.resolve(e)},function(e){console.log("deleteProduct() failure",e),n.reject(e)}),n.promise},s=function(e){var n=t.defer(),i={title:e.title,url:e.url,price:e.price,description:e.description};return null===i.url.match(/^http[s]?:\/\//i)&&(i.url="http://"+i.url),a.patch("/products/"+e.id+"/",i,!0).then(function(e){console.log("updateProduct() success",e),n.resolve(e)},function(e){console.log("updateProduct() failure",e),n.reject(e)}),n.promise},d=function(e){var a=t.defer(),n=[];return angular.forEach(e,function(e){var a=t.defer();n.push(a.promise),s(e).then(function(e){a.resolve(e)},function(e){a.reject(e)})}),t.all(n).then(function(){a.resolve()}),a.promise},c=function(e){var n=t.defer(),i={title:e.title,description:e.description,price:e.price,image_url:e.image_url,url:e.url,external_id:e.external_id,product:e.external_id+".png"};return null===i.url.match(/^http[s]?:\/\//i)&&(i.url="http://"+i.url),a.post("/products/",i,!0).then(function(e){console.log("createProductFromExternal() success",e),n.resolve(e)},function(e){console.log("createProductFromExternal() failure",e),n.reject(e)}),n.promise};return{getProduct:i,getProducts:n,deleteProduct:r,updateProduct:s,updateProducts:d,searchExternalProducts:o,createProductFromExternal:c}}])}(),function(){"use strict";angular.module("panelApp").factory("applicationsService",["$q","apiService","userService",function(e,t,a){var n=function(a){var n=e.defer(),i={limit:10,offset:0};return"object"==typeof a&&("limit"in a&&(i.limit=a.limit),"offset"in a&&(i.offset=a.offset),"name"in a&&(i.name=a.name),"api_key"in a&&(i.api_key=a.api_key)),t.get("/applications/",i,!0).then(function(e){console.log("getApps() success",e),n.resolve({count:e.count,items:e.results})},function(e){console.log("getApps() failure",e),n.reject(e)}),n.promise},i=function(a){var n=e.defer();return t.delete("/applications/"+a+"/",!1,!0).then(function(e){console.log("deleteApp() success",e),n.resolve(e)},function(e){console.log("deleteApp() failure",e),n.reject(e)}),n.promise},o=function(n,i){var o=e.defer();return a.getUser().then(function(e){var a={name:n,publisher:e.id,app_categories:i};t.post("/applications/",a,!0).then(function(e){console.log("addApp() success",e),o.resolve(e)},function(e){console.log("addApp() failure",e),o.reject(e)})},function(){o.reject(response)}),o.promise},r=function(a,n,i){var o=e.defer(),r={name:n,app_categories:i};return t.patch("/applications/"+a+"/",r,!0).then(function(e){console.log("updateApp() success",e),o.resolve(e)},function(e){console.log("updateApp() failure",e),o.reject(e)}),o.promise},s=function(a){var n=e.defer();return t.get("/campaigns/categories/",null,!0).then(function(e){var t=[];angular.forEach(e,function(e,n){n=parseInt(n);var i={id:n,name:e,selected:!1};"undefined"!=typeof a&&a.indexOf(n)!==-1&&(i.selected=!0),t.push(i)}),n.resolve(t)},function(e){n.reject(e)}),n.promise};return{getApps:n,deleteApp:i,addApp:o,updateApp:r,getCategories:s}}])}(),function(){"use strict";angular.module("panelApp").factory("billingService",["$q","apiService","$timeout","$http","apiUrl","authToken",function(e,t,a,n,i,o){var r=function(){var a=e.defer();return t.get("/payments/cards/",!1,!0).then(function(e){var n=e.results;n.length>0?t.get("/payments/cards/default/",!1,!0).then(function(e){angular.forEach(n,function(t){t.default=t.payment_method_id===e.payment_method_id}),a.resolve(n)},function(e){angular.forEach(n,function(e){e.default=!1}),a.resolve(n)}):a.resolve(n)},function(e){console.log("getCards() failure",e),a.reject(e)}),a.promise},s=function(a){var n=e.defer();return t.post("/payments/cards/",a,!0).then(function(e){console.log("addCard() success",e),n.resolve(e)},function(e){console.log("addCard() failure",e),n.reject(e)}),n.promise},d=function(a){var n=e.defer();return t.delete("/payments/cards/"+a+"/",!1,!0).then(function(e){console.log("deleteCard() success",e),n.resolve(e)},function(e){console.log("deleteCard() failure",e),n.reject(e)}),n.promise},c=function(a){var n=e.defer();return t.post("/payments/cards/"+a+"/default/",!1,!0).then(function(e){console.log("setMainCard() success",e),n.resolve(e)},function(e){console.log("setMainCard() failure",e),n.reject(e)}),n.promise},l=function(){var a=e.defer();return t.get("/payments/cards/default/",!1,!0).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise},u=function(){var a=e.defer();return t.get("/payments/cards/client_token/",!1,!0).then(function(e){console.log("getClientToken() success",e),a.resolve(e.client_token)},function(e){console.log("getClientToken() failure",e),a.reject(e)}),a.promise},p=function(a,n){var i=e.defer(),o={credits:n};return t.post("/payments/cards/"+a+"/buy_credits/",o,!0).then(function(e){console.log("buyCredits() success",e),i.resolve(e.client_token)},function(e){console.log("buyCredits() failure",e),i.reject(e)}),i.promise},m=function(a){var n=e.defer(),i={limit:10,offset:0,ordering:"-id"};return"object"==typeof a&&("limit"in a&&(i.limit=a.limit),"offset"in a&&(i.offset=a.offset),"start_date"in a&&(i.start_date=a.start_date),"end_date"in a&&(i.end_date=a.end_date)),t.get("/payments/transactions/",i,!0).then(function(e){console.log("getTransactions() success",e),n.resolve(e)},function(e){console.log("getTransactions() failure",e),n.reject(e)}),n.promise},g=function(t){var a=e.defer(),r={method:"GET",responseType:"blob",url:i+"/payments/transactions/"+t+"/invoice/",headers:{Authorization:"Token "+o.get(!0)}};return n(r).then(function(e){var n=new Blob([e.data],{type:"application/pdf"}),i=document.createElement("a");i.href=window.URL.createObjectURL(n),i.download="kaching_transaction_"+t+".pdf",i.click(),a.resolve(e)},function(e){a.reject(e)}),a.promise};return{getCards:r,addCard:s,deleteCard:d,setMainCard:c,getMainCard:l,getClientToken:u,buyCredits:p,getTransactions:m,getInvoicePdf:g}}])}(),function(){"use strict";angular.module("panelApp").directive("siteNav",function(){return{restrict:"A",replace:!0,templateUrl:kachingAppConfig.mainMenuTmpl}})}(),function(){"use strict";angular.module("panelApp").directive("owlCarousel",function(){return{restrict:"EA",transclude:!1,link:function(e,t,a){e.initCarousel=function(){var a={},n=e.$eval($(t).attr("data-options"));for(var i in n)a[i]=n[i];$(t).owlCarousel(a)}}}}),angular.module("panelApp").directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&e.initCarousel()}}}])}(),function(){"use strict";angular.module("panelApp").directive("campaignProduct",["utils",function(e){return{restrict:"A",scope:{product:"=campaignProduct",index:"=productIndex",showLabels:"=showLabels",onRemove:"&"},templateUrl:"panel-module/directives/campaignProduct/campaignProductTmpl.html",controller:["$scope",function(t){t.urlRegex=e.urlRegex(),t.remove=function(e){t.onRemove({index:e})}}]}}])}(),function(){"use strict";angular.module("panelApp").directive("ifmUploaderPreviewImage",["$window","$parse",function(e,t){var a={support:!!e.FileReader,isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|".indexOf(t)!==-1}};return{restrict:"A",link:function(e,n,i,o){var r;a.support&&e.$watch(i.ifmUploaderPreviewImage,function(o,s){if("string"==typeof o&&o.length>0){var d=t(i.ifmUploaderPreviewImage)(e);n.css("background-image","url("+d+")").addClass("image-selected")}else{if(!a.isFile(o))return;if(!a.isImage(o))return;r=new FileReader,r.onload=function(e){n.css("background-image","url("+e.target.result+")").addClass("image-selected")},r.readAsDataURL(o)}})}}}])}(),function(){"use strict";angular.module("panelApp").directive("ifmUploaderPreviewVideo",["$window",function(e){return{restrict:"A",link:function(e,t,a,n){e.$watch(a.ifmUploaderPreviewVideo,function(e,a){console.log("ifmUploaderPreviewVideo - newValue",e),"object"==typeof e&&t.addClass("video-selected")})}}}])}(),function(){"use strict";console.log("ifmMin loaded"),angular.module("panelApp").directive("ifmMin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){var i=parseFloat(a.ifmMin);n.$validators.ifmMin=function(e,t){if(n.$isEmpty(e))return!0;var a=parseFloat(t);return!isNaN(a)&&a>=i}}}})}(),function(){"use strict";angular.module("panelApp").directive("ifmMax",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){var i=parseFloat(a.ifmMax);n.$validators.ifmMax=function(e,t){if(n.$isEmpty(e))return!0;var a=parseFloat(t);return!isNaN(a)&&a<=i}}}})}(),function(){"use strict";console.log("ifmNumber loaded"),angular.module("panelApp").directive("ifmNumber",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){n.$validators.ifmNumber=function(e,t){return!!n.$isEmpty(e)||!isNaN(parseFloat(t))&&isFinite(t)}}}})}(),function(){"use strict";angular.module("panelApp").directive("campaignEditDetails",["$alert","$state","$stateParams","$filter","utils","errorHandler","campaignsService",function(e,t,a,n,i,o,r){return{restrict:"A",scope:{},templateUrl:"panel-module/directives/campaignEditDetails/campaignEditDetailsTmpl.html",controller:["$scope",function(n){n.fieldHasError=i.fieldHasError,n.view={busy:!1,submitted:!1},n.data={campaignId:a.campaignId,campaign:{}},n.daterange={dates:{startDate:null,endDate:null},min:moment().format("YYYY-MM-DD"),display:"Select date range"};var s=function(){n.view.busy=!0,r.getCampaign(n.data.campaignId).then(function(e){n.data.campaign=e,"undefined"!=typeof e.start_date&&"undefined"!=typeof e.end_date&&(n.daterange.dates.startDate=moment.utc(e.start_date),n.daterange.dates.endDate=moment.utc(e.end_date),n.daterange.display=n.daterange.dates.startDate.format("YYYY-MM-DD")+" - "+n.daterange.dates.endDate.format("YYYY-MM-DD")),n.view.busy=!1},function(e){o.processApiResponse(e)})};n.$watch(function(){return n.daterange.dates},function(e,t){void 0!==e&&null!==e.startDate&&null!==e.endDate&&(n.daterange.display=e.startDate.format("YYYY-MM-DD")+" - "+e.endDate.format("YYYY-MM-DD"))}),n.showErrors=function(){return n.view.submitted},n.saveForm=function(){if(n.view.submitted=!0,n.form1.$valid){var t={id:n.data.campaignId,name:n.data.campaign.name,start_date:moment(n.daterange.dates.startDate).format("YYYY-MM-DD")+"T00:00:00.000Z",end_date:moment(n.daterange.dates.endDate).format("YYYY-MM-DD")+"T23:59:59.999Z"};console.log("save",t),r.saveCampagin(t).then(function(){e({title:"Campaign details have been saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(e){o.processApiResponse(e)})}},n.cancelEdit=function(){t.go("campaigns")},s()}]}}])}(),function(){"use strict";angular.module("panelApp").directive("campaignEditTargeting",["$q","$alert","$state","$stateParams","campaignsService","errorHandler","utils",function(e,t,a,n,i,o,r){return{restrict:"A",scope:{},templateUrl:"panel-module/directives/campaignEditTargeting/campaignEditTargetingTmpl.html",controller:["$scope",function(e){e.fieldHasError=r.fieldHasError,e.view={busy:!1,showErrors:!1,errors:{},ageRanges:[]},e.data={allCategories:!0,allLocations:!0,categories:[],locations:[],gender:{male:!0,female:!0},os:{ios:!0,android:!0},ageRange:void 0},e.campaignId=n.campaignId;var s=function(){e.view.busy=!0,i.getTargeting(e.campaignId).then(function(t){e.data.allCategories=t.allCategories,e.data.allLocations=t.allLocations,e.data.categories=t.categories,e.data.locations=t.locations,e.data.gender=t.gender,e.data.os=t.os,e.data.ageRange=t.ageRange,e.view.ageRanges=t.ageRanges,e.view.busy=!1},function(e){o.processApiResponse(e)})};e.saveForm=function(){e.view.busy=!0,i.saveTargeting(e.campaignId,e.data).then(function(a){e.view.showErrors=!1,e.view.busy=!1,t({title:"Campaign details have been saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(t){e.view.busy=!1,"object"!=typeof t||_.isEmpty(t.validationErrors)?o.processApiResponse(t):(e.view.showErrors=!0,e.view.errors=t.validationErrors)})},e.resetError=function(t){"undefined"!=typeof e.view.errors[t]&&delete e.view.errors[t]},e.cancelEdit=function(){a.go("campaigns")},s()}]}}])}(),function(){"use strict";angular.module("panelApp").directive("campaignEditBudgeting",["$alert","$state","$stateParams","$timeout","campaignsService","errorHandler","utils",function(e,t,a,n,i,o,r){return{restrict:"A",scope:{},templateUrl:"panel-module/directives/campaignEditBudgeting/campaignEditBudgetingTmpl.html",controller:["$scope",function(n){n.fieldHasError=r.fieldHasError,n.hasBudget=!0,n.view={busy:!1,showCharts:!1,submitted:!1},n.data={campaignId:a.campaignId,budgetId:void 0,budgetType:"ongoing",bidAmount:void 0,budgetAmount:void 0},n.estViews={daily:{percentage:0,min:0,max:0},total:{percentage:0,min:0,max:0}},n.estDailyViewsChart={data:[n.estViews.daily.percentage,100-n.estViews.daily.percentage],labels:["",""],colours:["#f9cd3f","#dae2e5"],options:{animationEasing:"easeOutQuart",showTooltips:!1,segmentShowStroke:!1,percentageInnerCutout:85}},n.estTotalViewsChart={data:[n.estViews.total.percentage,100-n.estViews.total.percentage],labels:["",""],colours:["#343b45","#dae2e5"],options:{animationEasing:"easeOutQuart",showTooltips:!1,segmentShowStroke:!1,percentageInnerCutout:85}};var s=function(e){var t=["ongoing","fixed","daily"];return"number"==typeof e?t[e-1]:"string"==typeof e?(e=t.indexOf(e),e+1):void 0},d=function(){n.view.busy=!0,i.getCampaignBudget(n.data.campaignId).then(function(e){"undefined"==typeof e?n.hasBudget=!1:(n.data.budgetId=e.id,n.data.bidAmount=e.cost_per_view,n.data.budgetAmount=e.amount,n.data.budgetType=s(e.type)),n.view.busy=!1,c()},function(e){o.processApiResponse(e)})};n.changedBid=function(){c()};var c=function(){"undefined"==typeof n.data.bidAmount?(n.estViews={daily:{percentage:0,min:0,max:0},total:{percentage:0,min:0,max:0}},l(),n.view.showCharts=!0):i.getEstimatedViews(n.data.campaignId,n.data.bidAmount).then(function(e){n.estViews=e,l(),n.view.showCharts=!0},function(e){o.processApiResponse(e)})},l=function(){n.estDailyViewsChart.data=[n.estViews.daily.percentage,100-n.estViews.daily.percentage],n.estTotalViewsChart.data=[n.estViews.total.percentage,100-n.estViews.total.percentage]};n.showErrors=function(){return n.view.submitted},n.saveForm=function(){if(n.view.submitted=!0,n.form1.$valid){var t={cost_per_view:n.data.bidAmount,amount:n.data.budgetAmount,type:s(n.data.budgetType)};"ongoing"===n.data.budgetType&&(t.amount=0),i.saveCampaignBudget(n.data.campaignId,t,n.hasBudget,n.data.budgetId).then(function(t){e({title:"Campaign details have been saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(e){o.processApiResponse(e)})}},n.cancelEdit=function(){t.go("campaigns")},d()}]}}])}(),function(){"use strict";angular.module("panelApp").directive("campaignEditMedia",["$state","$stateParams","$alert","$sce","apiUrl","utils","$modal","errorHandler","mediaService","campaignsService",function(e,t,a,n,i,o,r,s,d,c){return{restrict:"A",scope:{},templateUrl:"panel-module/directives/campaignEditMedia/campaignEditMediaTmpl.html",controller:["$scope",function(i){i.fieldHasError=o.fieldHasError,i.videogular={sources:[]},i.videogularApi=null,i.view={loading:!1,submitted:!1,loadingMedia:!1,mediaLoaded:!1,playerReady:!1,videoSet:!1},i.data={campaignId:t.campaignId,campaign:{},media:{},mediaTitle:"",mediaDesc:""};var l=function(){i.view.loading=!0,c.getCampaign(i.data.campaignId).then(function(e){i.data.campaign=e,e.media.length>0&&"object"==typeof e.media[0]&&(i.data.media=e.media[0],i.data.mediaTitle=e.media[0].media_title,i.data.mediaDesc=e.media[0].media_description),i.view.loading=!1,u()&&(i.view.mediaLoaded=!0,i.view.playerReady&&i.setVideo())})},u=function(){return"string"==typeof i.data.media.video};i.hasMedia=function(){return 0!==Object.getOwnPropertyNames(i.data.media).length},i.onPlayerReady=function(e){i.view.playerReady=!0,i.videogularApi=e,u()&&!i.view.videoSet&&i.setVideo()},i.setVideo=function(){i.videogularApi.stop(),i.videogular.sources=[{src:n.trustAsResourceUrl(i.data.media.video),type:"video/mp4"}],i.view.videoSet=!0},i.showMediaLibrary=function(){var e={submit:function(e){i.getMedia(e.id)}};r({templateUrl:"panel-module/components/mediaLibraryModal/modalTmpl.html",controller:"mediaLibraryModalCtrl",animation:"am-fade-and-scale",resolve:{modalOptions:function(){return e}}})},i.showNewMediaDialog=function(){var e={mode:"campaignEditor",submit:function(e){console.log("mediaId",e),i.getMedia(e)}};r({templateUrl:"panel-module/components/newMediaModal/modalTmpl.html",controller:"newMediaModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return e}}})},i.getMedia=function(e){i.view.loadingMedia=!0,i.view.mediaLoaded=!1,d.getMediaItem(e).then(function(e){i.data.media=e,i.setVideo(),i.view.loadingMedia=!1,i.view.mediaLoaded=!0},function(){i.view.loadingMedia=!1})},i.showErrors=function(){return i.view.submitted},i.saveForm=function(){if(i.view.submitted=!0,i.form1.$valid){var e={campaignId:i.data.campaignId,media:i.data.media.id,media_title:i.data.mediaTitle,media_description:i.data.mediaDesc};console.log("save : mediaData",e),c.saveMedia(e).then(function(){a({title:"Campaign details have been saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(e){s.processApiResponse(e)})}},i.cancelEdit=function(){e.go("campaigns")},l()}]}}])}(),function(){"use strict";angular.module("panelApp").directive("campaignEditProducts",["$state","$stateParams","$alert","$sce","apiUrl","utils","$modal","errorHandler","productsService","campaignsService",function(e,t,a,n,i,o,r,s,d,c){return{restrict:"A",scope:{},templateUrl:"panel-module/directives/campaignEditProducts/campaignEditProductsTmpl.html",controller:["$scope",function(n){n.fieldHasError=o.fieldHasError,n.videogular={sources:[]},n.videogularApi=null,n.view={loading:!1,submitted:!1,loadingMedia:!1,mediaLoaded:!1,playerReady:!1,videoSet:!1},n.data={campaignId:t.campaignId,campaign:{},products:[]};var i=function(){n.view.loading=!0,c.getCampaign(n.data.campaignId).then(function(e){n.data.campaign=e,e.products.length>0&&(n.data.products=e.products),n.view.loading=!1})};n.hasProducts=function(){return!_.isEmpty(n.data.products)},n.removeProduct=function(e){n.data.products.splice(e,1)},n.showErrors=function(){return n.view.submitted},n.showProductsLibrary=function(){var e={submit:function(e){n.data.products.unshift(e)}};r({templateUrl:"panel-module/components/producstLibraryModal/modalTmpl.html",controller:"producstLibraryModalCtrl",animation:"am-fade-and-scale",resolve:{modalOptions:function(){return e}}})},n.showNewProductDialog=function(){var e={mode:"campaignEditor",submit:function(e){console.log("newProduct",e),n.data.products.unshift(e)}};r({templateUrl:"panel-module/components/newProductModal/modalTmpl.html",controller:"newProductModalCtrl",animation:"am-fade-and-scale",backdrop:"static",resolve:{modalOptions:function(){return e}}})},n.saveForm=function(){n.view.submitted=!0,n.form1.$valid&&(console.log("save : data",n.data.campaignId,n.data.products),d.updateProducts(n.data.products).then(function(){c.saveProducts(n.data.campaignId,n.data.products).then(function(e){a({title:"Campaign details have been saved.",content:"",container:"#alerts-container",placement:"top",duration:3,type:"success",show:!0})},function(e){s.processApiResponse(e)})},function(e){s.processApiResponse(e)}))},n.cancelEdit=function(){e.go("campaigns")},i()}]}}])}(),function(){"use strict";angular.module("panelApp").filter("campaignStatus",function(){return function(e){var t=["Incomplete","Billing","Prepared","Live","Completed","Stopped"];return t[parseInt(e)]}})}(),function(){"use strict";angular.module("panelApp").filter("transactionStatus",function(){return function(e){var t=["Pending","Completed","Failed"];return t[parseInt(e)-1]}})}(),function(){"use strict";angular.module("panelApp").filter("transactionType",function(){return function(e){var t=["One time pay"];return t[parseInt(e)-1]}})}(),function(){"use strict";angular.module("panelApp").filter("budgetType",function(){return function(e){var t=["Ongoing","Fixed","Daily"];return t[e-1]}})}(),function(){"use strict";angular.module("panelApp").filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}])}();
})(jQuery);